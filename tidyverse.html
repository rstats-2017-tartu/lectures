<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Reprodutseeritav andmeanalüüs kasutades R keelt</title>
  <meta name="description" content="Praktilise kursuse ‘Reprodutseeritav andmeanalüüs R keeles’ materjalid.">
  <meta name="generator" content="bookdown 0.5.2 and GitBook 2.6.7">

  <meta property="og:title" content="Reprodutseeritav andmeanalüüs kasutades R keelt" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="assets/img/cover.png" />
  <meta property="og:description" content="Praktilise kursuse ‘Reprodutseeritav andmeanalüüs R keeles’ materjalid." />
  <meta name="github-repo" content="rstats-tartu/lectures" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Reprodutseeritav andmeanalüüs kasutades R keelt" />
  
  <meta name="twitter:description" content="Praktilise kursuse ‘Reprodutseeritav andmeanalüüs R keeles’ materjalid." />
  <meta name="twitter:image" content="assets/img/cover.png" />

<meta name="author" content="Taavi Päll, Ülo Maiväli">


<meta name="date" content="2017-10-05">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="graafilised-lahendused.html">
<link rel="next" href="bibliograafia.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />








<script src="https://use.fontawesome.com/e4ba4259a1.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Reprodutseeritav andmeanalüüs R programmiga</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Haara kannel, Vanemuine!</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Sissejuhatus</a></li>
<li class="chapter" data-level="2" data-path="tools.html"><a href="tools.html"><i class="fa fa-check"></i><b>2</b> Tarkvaratööriistad</a><ul>
<li class="chapter" data-level="2.1" data-path="tools.html"><a href="tools.html#installeeri-vajalikud-programmid"><i class="fa fa-check"></i><b>2.1</b> Installeeri vajalikud programmid</a></li>
<li class="chapter" data-level="2.2" data-path="tools.html"><a href="tools.html#loo-githubi-konto"><i class="fa fa-check"></i><b>2.2</b> Loo GitHubi konto</a></li>
<li class="chapter" data-level="2.3" data-path="tools.html"><a href="tools.html#loo-uus-r-projekt"><i class="fa fa-check"></i><b>2.3</b> Loo uus R projekt</a></li>
<li class="chapter" data-level="2.4" data-path="tools.html"><a href="tools.html#git-merge-konfliktid"><i class="fa fa-check"></i><b>2.4</b> Git <em>Merge</em> konfliktid</a></li>
<li class="chapter" data-level="2.5" data-path="tools.html"><a href="tools.html#r-projekti-kataloogi-soovitatav-minimaalne-struktuur"><i class="fa fa-check"></i><b>2.5</b> R projekti kataloogi soovitatav minimaalne struktuur</a></li>
<li class="chapter" data-level="2.6" data-path="tools.html"><a href="tools.html#libs"><i class="fa fa-check"></i><b>2.6</b> Pakettide installeerimine</a></li>
<li class="chapter" data-level="2.7" data-path="tools.html"><a href="tools.html#r-repositooriumid"><i class="fa fa-check"></i><b>2.7</b> R repositooriumid</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="calc.html"><a href="calc.html"><i class="fa fa-check"></i><b>3</b> R on kalkulaator</a><ul>
<li class="chapter" data-level="3.1" data-path="calc.html"><a href="calc.html#sama-koodi-saab-kirjutada-neljal-viisil"><i class="fa fa-check"></i><b>3.1</b> Sama koodi saab kirjutada neljal viisil</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="obj.html"><a href="obj.html"><i class="fa fa-check"></i><b>4</b> R objektid</a><ul>
<li class="chapter" data-level="4.1" data-path="obj.html"><a href="obj.html#objekt-ja-nimi"><i class="fa fa-check"></i><b>4.1</b> Objekt ja nimi</a></li>
<li class="chapter" data-level="4.2" data-path="obj.html"><a href="obj.html#nimede-vorm"><i class="fa fa-check"></i><b>4.2</b> Nimede vorm</a></li>
<li class="chapter" data-level="4.3" data-path="obj.html"><a href="obj.html#andmete-tuubid"><i class="fa fa-check"></i><b>4.3</b> Andmete tüübid</a></li>
<li class="chapter" data-level="4.4" data-path="obj.html"><a href="obj.html#vektor"><i class="fa fa-check"></i><b>4.4</b> Vektor</a><ul>
<li class="chapter" data-level="4.4.1" data-path="obj.html"><a href="obj.html#uus-vektor-seq-ja-rep"><i class="fa fa-check"></i><b>4.4.1</b> Uus vektor: <code>seq()</code> ja <code>rep()</code></a></li>
<li class="chapter" data-level="4.4.2" data-path="obj.html"><a href="obj.html#tehted-arvuliste-vektoritega"><i class="fa fa-check"></i><b>4.4.2</b> Tehted arvuliste vektoritega</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="obj.html"><a href="obj.html#list"><i class="fa fa-check"></i><b>4.5</b> List</a></li>
<li class="chapter" data-level="4.6" data-path="obj.html"><a href="obj.html#data-frame-ja-tibble"><i class="fa fa-check"></i><b>4.6</b> data frame ja tibble</a><ul>
<li class="chapter" data-level="4.6.1" data-path="obj.html"><a href="obj.html#rekodeerime-tibble-vaartusi"><i class="fa fa-check"></i><b>4.6.1</b> Rekodeerime tibble väärtusi</a></li>
<li class="chapter" data-level="4.6.2" data-path="obj.html"><a href="obj.html#uhendame-kaks-tibblet-rea-kaupa"><i class="fa fa-check"></i><b>4.6.2</b> Ühendame kaks tibblet rea kaupa</a></li>
<li class="chapter" data-level="4.6.3" data-path="obj.html"><a href="obj.html#uhendame-kaks-tibblet-veeru-kaupa"><i class="fa fa-check"></i><b>4.6.3</b> ühendame kaks tibblet veeru kaupa</a></li>
<li class="chapter" data-level="4.6.4" data-path="obj.html"><a href="obj.html#nii-saab-tibblest-katte-vektori-millega-saab-tehteid-teha."><i class="fa fa-check"></i><b>4.6.4</b> Nii saab tibblest kätte vektori, millega saab tehteid teha.</a></li>
<li class="chapter" data-level="4.6.5" data-path="obj.html"><a href="obj.html#andmeraamide-salvestamine-eksport-import"><i class="fa fa-check"></i><b>4.6.5</b> Andmeraamide salvestamine (eksport-import)</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="obj.html"><a href="obj.html#tabelit-sisse-lugedes-vaata-ule-na-d"><i class="fa fa-check"></i><b>4.7</b> Tabelit sisse lugedes vaata üle NA-d</a></li>
<li class="chapter" data-level="4.8" data-path="obj.html"><a href="obj.html#matrix"><i class="fa fa-check"></i><b>4.8</b> Matrix</a></li>
<li class="chapter" data-level="4.9" data-path="obj.html"><a href="obj.html#indekseerimine"><i class="fa fa-check"></i><b>4.9</b> Indekseerimine</a><ul>
<li class="chapter" data-level="4.9.1" data-path="obj.html"><a href="obj.html#vektorid-ja-nende-indeksid-on-uhedimensionaalsed"><i class="fa fa-check"></i><b>4.9.1</b> Vektorid ja nende indeksid on ühedimensionaalsed</a></li>
<li class="chapter" data-level="4.9.2" data-path="obj.html"><a href="obj.html#andmeraamid-ja-maatriksid-on-kahedimensionaalsed-nagu-ka-nende-indeksid"><i class="fa fa-check"></i><b>4.9.2</b> Andmeraamid ja maatriksid on kahedimensionaalsed, nagu ka nende indeksid</a></li>
<li class="chapter" data-level="4.9.3" data-path="obj.html"><a href="obj.html#listide-indekseerimine"><i class="fa fa-check"></i><b>4.9.3</b> Listide indekseerimine</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="regex.html"><a href="regex.html"><i class="fa fa-check"></i><b>5</b> Regular expression ja find &amp; replace</a><ul>
<li class="chapter" data-level="5.1" data-path="regex.html"><a href="regex.html#common-operations-with-regular-expressions"><i class="fa fa-check"></i><b>5.1</b> Common operations with regular expressions</a></li>
<li class="chapter" data-level="5.2" data-path="regex.html"><a href="regex.html#find-and-replace"><i class="fa fa-check"></i><b>5.2</b> Find and replace</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="funs.html"><a href="funs.html"><i class="fa fa-check"></i><b>6</b> Funktsioonid on R keele verbid</a><ul>
<li class="chapter" data-level="6.1" data-path="funs.html"><a href="funs.html#kirjutame-r-funktsiooni"><i class="fa fa-check"></i><b>6.1</b> Kirjutame R funktsiooni</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html"><i class="fa fa-check"></i><b>7</b> Graafilised lahendused</a><ul>
<li class="chapter" data-level="7.1" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#baasgraafika"><i class="fa fa-check"></i><b>7.1</b> Baasgraafika</a></li>
<li class="chapter" data-level="7.2" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#ggplot2"><i class="fa fa-check"></i><b>7.2</b> ggplot2</a></li>
<li class="chapter" data-level="7.3" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#regressioonisirgete-plottimine"><i class="fa fa-check"></i><b>7.3</b> Regressioonisirgete plottimine</a><ul>
<li class="chapter" data-level="7.3.1" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#lisame-plotile-sirgjooni"><i class="fa fa-check"></i><b>7.3.1</b> Lisame plotile sirgjooni</a></li>
<li class="chapter" data-level="7.3.2" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#segmendid-ja-nooled"><i class="fa fa-check"></i><b>7.3.2</b> Segmendid ja nooled</a></li>
<li class="chapter" data-level="7.3.3" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#joongraafikud"><i class="fa fa-check"></i><b>7.3.3</b> Joongraafikud</a></li>
<li class="chapter" data-level="7.3.4" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#punktide-tahistamise-trikid"><i class="fa fa-check"></i><b>7.3.4</b> Punktide tähistamise trikid</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#facet-pisigraafik"><i class="fa fa-check"></i><b>7.4</b> <em>Facet</em> – pisigraafik</a><ul>
<li class="chapter" data-level="7.4.1" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#telgede-ulatus"><i class="fa fa-check"></i><b>7.4.1</b> Telgede ulatus</a></li>
<li class="chapter" data-level="7.4.2" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#log-skaalas-teljed"><i class="fa fa-check"></i><b>7.4.2</b> Log skaalas teljed</a></li>
<li class="chapter" data-level="7.4.3" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#poorame-graafikut-90-kraadi"><i class="fa fa-check"></i><b>7.4.3</b> Pöörame graafikut 90 kraadi</a></li>
<li class="chapter" data-level="7.4.4" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#muudame-telgede-markeeringuid"><i class="fa fa-check"></i><b>7.4.4</b> Muudame telgede markeeringuid</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#telgede-tekst-ja-pealkirjad"><i class="fa fa-check"></i><b>7.5</b> Telgede tekst ja pealkirjad</a><ul>
<li class="chapter" data-level="7.5.1" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#muudame-telgede-ja-legendi-nimed"><i class="fa fa-check"></i><b>7.5.1</b> Muudame telgede ja legendi nimed</a></li>
<li class="chapter" data-level="7.5.2" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#graafiku-pealkiri-alapeakiri-ja-allkiri"><i class="fa fa-check"></i><b>7.5.2</b> Graafiku pealkiri, alapeakiri ja allkiri</a></li>
<li class="chapter" data-level="7.5.3" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#graafiku-legend"><i class="fa fa-check"></i><b>7.5.3</b> Graafiku legend</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#varviskaalad"><i class="fa fa-check"></i><b>7.6</b> Värviskaalad</a><ul>
<li class="chapter" data-level="7.6.1" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#varviskaalad-pidevatele-muutujatele"><i class="fa fa-check"></i><b>7.6.1</b> Värviskaalad pidevatele muutujatele</a></li>
<li class="chapter" data-level="7.6.2" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#varviskaalad-faktormuutujatele"><i class="fa fa-check"></i><b>7.6.2</b> Värviskaalad faktormuutujatele</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#a-complex-ggplot"><i class="fa fa-check"></i><b>7.7</b> A complex ggplot</a></li>
<li class="chapter" data-level="7.8" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#erinevad-ggplot-geom_-id"><i class="fa fa-check"></i><b>7.8</b> Erinevad ggplot geom_-id</a><ul>
<li class="chapter" data-level="7.8.1" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#kui-iga-muutja-kohta-on-uks-andmepunkt"><i class="fa fa-check"></i><b>7.8.1</b> Kui iga muutja kohta on üks andmepunkt</a></li>
<li class="chapter" data-level="7.8.2" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#tulpdiagrammid-moodavad-counte-ja-proportsioone"><i class="fa fa-check"></i><b>7.8.2</b> Tulpdiagrammid mõõdavad counte ja proportsioone</a></li>
<li class="chapter" data-level="7.8.3" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#andmepunktid-on-ukshaaval-valja-plotitud"><i class="fa fa-check"></i><b>7.8.3</b> Andmepunktid on ükshaaval välja plotitud</a></li>
<li class="chapter" data-level="7.8.4" data-path="graafilised-lahendused.html"><a href="graafilised-lahendused.html#kahe-muutuja-koos-varieeruvus"><i class="fa fa-check"></i><b>7.8.4</b> Kahe muutuja koos-varieeruvus</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="tidyverse.html"><a href="tidyverse.html"><i class="fa fa-check"></i><b>8</b> Tidyverse</a><ul>
<li class="chapter" data-level="8.1" data-path="tidyverse.html"><a href="tidyverse.html#tidy-tabeli-struktuur"><i class="fa fa-check"></i><b>8.1</b> Tidy tabeli struktuur</a><ul>
<li class="chapter" data-level="8.1.1" data-path="tidyverse.html"><a href="tidyverse.html#tabeli-dimensioonide-muutmine-pikk-ja-lai-formaat"><i class="fa fa-check"></i><b>8.1.1</b> Tabeli dimensioonide muutmine (pikk ja lai formaat)</a></li>
<li class="chapter" data-level="8.1.2" data-path="tidyverse.html"><a href="tidyverse.html#tibble-transpose-read-veergudeks-ja-vastupidi"><i class="fa fa-check"></i><b>8.1.2</b> Tibble transpose — read veergudeks ja vastupidi</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="tidyverse.html"><a href="tidyverse.html#dplyr-ja-selle-viis-verbi"><i class="fa fa-check"></i><b>8.2</b> dplyr ja selle viis verbi</a><ul>
<li class="chapter" data-level="8.2.1" data-path="tidyverse.html"><a href="tidyverse.html#select-columns"><i class="fa fa-check"></i><b>8.2.1</b> <code>select()</code> columns</a></li>
<li class="chapter" data-level="8.2.2" data-path="tidyverse.html"><a href="tidyverse.html#filter-rows"><i class="fa fa-check"></i><b>8.2.2</b> <code>filter()</code> rows</a></li>
<li class="chapter" data-level="8.2.3" data-path="tidyverse.html"><a href="tidyverse.html#summarise"><i class="fa fa-check"></i><b>8.2.3</b> <code>summarise()</code></a></li>
<li class="chapter" data-level="8.2.4" data-path="tidyverse.html"><a href="tidyverse.html#group_by"><i class="fa fa-check"></i><b>8.2.4</b> <code>group_by()</code></a></li>
<li class="chapter" data-level="8.2.5" data-path="tidyverse.html"><a href="tidyverse.html#mutate"><i class="fa fa-check"></i><b>8.2.5</b> <code>mutate()</code></a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="tidyverse.html"><a href="tidyverse.html#grouped-filters"><i class="fa fa-check"></i><b>8.3</b> Grouped filters</a></li>
<li class="chapter" data-level="8.4" data-path="tidyverse.html"><a href="tidyverse.html#separate-one-column-into-several"><i class="fa fa-check"></i><b>8.4</b> <code>separate()</code> one column into several</a></li>
<li class="chapter" data-level="8.5" data-path="tidyverse.html"><a href="tidyverse.html#faktorid"><i class="fa fa-check"></i><b>8.5</b> Faktorid</a><ul>
<li class="chapter" data-level="8.5.1" data-path="tidyverse.html"><a href="tidyverse.html#fct_recode-rekodeerib-faktori-tasemed"><i class="fa fa-check"></i><b>8.5.1</b> <code>fct_recode()</code> rekodeerib faktori tasemed</a></li>
<li class="chapter" data-level="8.5.2" data-path="tidyverse.html"><a href="tidyverse.html#fct_collapse-annab-argumenti-sisse-vanade-tasemete-vektori-et-teha-vahem-uusi-tasemeid."><i class="fa fa-check"></i><b>8.5.2</b> <code>fct_collapse()</code> annab argumenti sisse vanade tasemete vektori, et teha vähem uusi tasemeid.</a></li>
<li class="chapter" data-level="8.5.3" data-path="tidyverse.html"><a href="tidyverse.html#fct_lump-loob-kokku-koik-vahem-arv-kordi-esinevad-tasemed."><i class="fa fa-check"></i><b>8.5.3</b> <code>fct_lump()</code> lööb kokku kõik vähem arv kordi esinevad tasemed.</a></li>
<li class="chapter" data-level="8.5.4" data-path="tidyverse.html"><a href="tidyverse.html#rekodeerime-pideva-muutuja-faktoriks"><i class="fa fa-check"></i><b>8.5.4</b> Rekodeerime pideva muutuja faktoriks</a></li>
<li class="chapter" data-level="8.5.5" data-path="tidyverse.html"><a href="tidyverse.html#muudame-faktori-tasemete-jarjekorda-joonisel"><i class="fa fa-check"></i><b>8.5.5</b> Muudame faktori tasemete järjekorda joonisel</a></li>
<li class="chapter" data-level="8.5.6" data-path="tidyverse.html"><a href="tidyverse.html#fct_relevel-tostab-joonisel-osad-tasemed-teistest-ettepoole"><i class="fa fa-check"></i><b>8.5.6</b> <code>fct_relevel()</code> tõstab joonisel osad tasemed teistest ettepoole</a></li>
<li class="chapter" data-level="8.5.7" data-path="tidyverse.html"><a href="tidyverse.html#joontega-plotil-saab-fct_reorder2-abil-assotseerida-y-vaartused-suurimate-x-vaartustega"><i class="fa fa-check"></i><b>8.5.7</b> Joontega plotil saab <code>fct_reorder2()</code> abil assotseerida y väärtused suurimate x väärtustega</a></li>
<li class="chapter" data-level="8.5.8" data-path="tidyverse.html"><a href="tidyverse.html#tulpdiagrammide-korral-kasuta-fct_infreq"><i class="fa fa-check"></i><b>8.5.8</b> Tulpdiagrammide korral kasuta <code>fct_infreq()</code></a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="tidyverse.html"><a href="tidyverse.html#suur-ja-vaike-maailm"><i class="fa fa-check"></i><b>8.6</b> Suur ja väike maailm</a></li>
<li class="chapter" data-level="8.7" data-path="tidyverse.html"><a href="tidyverse.html#mudeli-vaike-maailm"><i class="fa fa-check"></i><b>8.7</b> Mudeli väike maailm</a><ul>
<li class="chapter" data-level="8.7.1" data-path="tidyverse.html"><a href="tidyverse.html#naide-aristoteles-ptolemaios-ja-kopernikus"><i class="fa fa-check"></i><b>8.7.1</b> Näide: Aristoteles, Ptolemaios ja Kopernikus</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="tidyverse.html"><a href="tidyverse.html#lineaarsed-mudelid"><i class="fa fa-check"></i><b>8.8</b> Lineaarsed mudelid</a><ul>
<li class="chapter" data-level="8.8.1" data-path="tidyverse.html"><a href="tidyverse.html#neli-moistet"><i class="fa fa-check"></i><b>8.8.1</b> Neli mõistet</a></li>
<li class="chapter" data-level="8.8.2" data-path="tidyverse.html"><a href="tidyverse.html#mudeli-fittimine"><i class="fa fa-check"></i><b>8.8.2</b> Mudeli fittimine</a></li>
<li class="chapter" data-level="8.8.3" data-path="tidyverse.html"><a href="tidyverse.html#kaks-lineaarse-mudeli-laiendust."><i class="fa fa-check"></i><b>8.8.3</b> kaks lineaarse mudeli laiendust.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="bibliograafia.html"><a href="bibliograafia.html"><i class="fa fa-check"></i>Bibliograafia</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstats-tartu/lectures" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reprodutseeritav andmeanalüüs kasutades R keelt</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tidyverse" class="section level1">
<h1><span class="header-section-number">8</span> Tidyverse</h1>
<p>Tidyverse on osa R-i ökosüsteemist, kus kehtivad omad reeglid. Tidyverse raamatukogud lähtuvad ühtsest filosoofiast ja töötavad hästi koos. Tidyverse algab andmetabeli struktuurist ja selle funktsioonid võtavad reeglina sisse õige struktuuriga tibble ja väljastavad samuti tibble, mis sobib hästi järgmise tidyverse funktsiooni sisendiks. Seega on tidyverse hästi sobiv läbi torude %&gt;% laskmiseks. Tidyverse-ga sobib hästi kokku ka ggplot2 graafikasüsteem.</p>
<div id="tidy-tabeli-struktuur" class="section level2">
<h2><span class="header-section-number">8.1</span> Tidy tabeli struktuur</h2>
<ul>
<li><strong>väärtus</strong> (<em>value</em>) — ühe mõõtmise tulemus (183 cm)</li>
<li><strong>muutuja</strong> (<em>variable</em>) — see, mida sa mõõdad (pikkus) või faktor (sex)</li>
<li><strong>andmepunkt</strong> (<em>observation</em>) — väärtused, mis mõõdeti samal katsetingimusel (1. subjekti pikkus ja kaal 3h ajapunktis)</li>
<li><strong>vaatlusühik</strong> (<em>unit of measurement</em>) — keda mõõdeti (subjekt nr 1)</li>
<li><strong>vaatlusühiku tüüp</strong> — inimene, hiir, jt</li>
</ul>
<blockquote>
<p>vaatlusühiku tüüp = tabel</p>
</blockquote>
<blockquote>
<p>muutuja = veerg</p>
</blockquote>
<blockquote>
<p>andmepunkt = rida</p>
</blockquote>
<blockquote>
<p>vaatlusühikute koodid on kõik koos ühes veerus</p>
</blockquote>
<p>Veergude järjekord tabelis on 1. vaatlusühik, 2. faktor, mis annab katse-kontrolli erisuse, 3. kõik see, mida otse ei mõõdetud (sex, batch nr, etc.), 4. numbritega veerud (iga muutuja kohta üks veerg)</p>
<pre><code>## # A tibble: 2 x 6
##   subject    drug   sex  time length weigth
##     &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1       1     exp     F     3    168     88
## 2       2 placebo     M     3    176     91</code></pre>
<p>Nii näeb välja tidy tibble. Kõik analüüsil vajalikud parameetrid tuleks siia tabelisse veeru kaupa sisse tuua. Näiteks, kui mõõtmised on sooritatud erinevates keskustes erinevate inimeste poolt kasutades sama ravimi erinevaid preparaate, oleks hea siia veel 3 veergu lisada (center, experimenter, batch).</p>
<div id="tabeli-dimensioonide-muutmine-pikk-ja-lai-formaat" class="section level3">
<h3><span class="header-section-number">8.1.1</span> Tabeli dimensioonide muutmine (pikk ja lai formaat)</h3>
<p>Väga oluline osa tidyverses töötamisest on tabelite pika ja laia formaadi vahel viimine.</p>
<p>See on laias formaadis tabel df, mis ei ole tidy</p>
<pre><code>## # A tibble: 3 x 5
##   subject   sex control experiment_1 experiment_2
##     &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
## 1     Tim     M      23           34           40
## 2     Ann     F      31           38           42
## 3    Jill     F      30           36           44</code></pre>
<p>Kõigepealt pikka formaati. key ja value argumendid on ainult uute veergude nimetamiseks, oluline on 3:ncol(dat) argument, mis ütleb, et “kogu kokku veerud alates 3. veerust”. Alternatiivne viis seda öelda: c(-subject, -sex).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat_lng &lt;-<span class="st"> </span><span class="kw">gather</span>(dat, <span class="dt">key =</span> experiment, <span class="dt">value =</span> value, <span class="dv">3</span><span class="op">:</span><span class="kw">ncol</span>(dat))
<span class="co"># df_l3&lt;-df %&gt;% gather(experiment, value, 3:ncol(df)) works as well.</span>
<span class="co">#df_l4&lt;-df %&gt;% gather(experiment, value, c(-subject, -sex)) works as well</span>
dat_lng</code></pre></div>
<pre><code>## # A tibble: 9 x 4
##   subject   sex   experiment value
##     &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt;
## 1     Tim     M      control    23
## 2     Ann     F      control    31
## 3    Jill     F      control    30
## 4     Tim     M experiment_1    34
## 5     Ann     F experiment_1    38
## 6    Jill     F experiment_1    36
## 7     Tim     M experiment_2    40
## 8     Ann     F experiment_2    42
## 9    Jill     F experiment_2    44</code></pre>
<p>Paneme selle tagasi algsesse laia formaati: ?spread</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">spread</span>(dat_lng, <span class="dt">key =</span> experiment, <span class="dt">value =</span> value)</code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   subject   sex control experiment_1 experiment_2
## *   &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
## 1     Ann     F      31           38           42
## 2    Jill     F      30           36           44
## 3     Tim     M      23           34           40</code></pre>
<p>key viitab pika tabeli veerule, mille väärtustest tulevad laias tabelis uute veergude nimed. value viitab pika tabeli veerule, kust võetakse arvud, mis uues laias tabelis uute veergude vahel laiali jagatakse.</p>
</div>
<div id="tibble-transpose-read-veergudeks-ja-vastupidi" class="section level3">
<h3><span class="header-section-number">8.1.2</span> Tibble transpose — read veergudeks ja vastupidi</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">a =</span> <span class="kw">c</span>(<span class="st">&quot;tim&quot;</span>, <span class="st">&quot;tom&quot;</span>, <span class="st">&quot;jill&quot;</span>), <span class="dt">b1 =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="dt">b2 =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>))
dat</code></pre></div>
<pre><code>## # A tibble: 3 x 3
##       a    b1    b2
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1   tim     1     4
## 2   tom     2     5
## 3  jill     3     6</code></pre>
<p>Me kasutame selleks maatriksarvutuse funktsiooni t() — transpose. See võtab sisse ainult numbrilisi veerge, seega anname talle ette df miinus 1. veerg, mille sisu me konverteerime uue tablei veerunimedeks.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat1 &lt;-<span class="st"> </span><span class="kw">t</span>(dat[,<span class="op">-</span><span class="dv">1</span>])
<span class="kw">colnames</span>(dat1) &lt;-<span class="st"> </span>dat<span class="op">$</span>a
dat1</code></pre></div>
<pre><code>##    tim tom jill
## b1   1   2    3
## b2   4   5    6</code></pre>
</div>
</div>
<div id="dplyr-ja-selle-viis-verbi" class="section level2">
<h2><span class="header-section-number">8.2</span> dplyr ja selle viis verbi</h2>
<p>Need tuleb teil omale pähe ajada sest nende 5 verbiga (pluss gather ja spread) saab lihtsalt teha 90% andmeväänamisest, mida teil elus ette tuleb. NB! Check the data wrangling cheatsheet and dplyr help for further details. dplyr laetakse koos tidyverse-ga automaatselt teie workspace-i.</p>
<div id="select-columns" class="section level3">
<h3><span class="header-section-number">8.2.1</span> <code>select()</code> columns</h3>
<p><code>select()</code> selects, renames, and re-orders columns.</p>
<p>Select columns from sex to value:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris
<span class="kw">select</span>(iris, Petal.Length<span class="op">:</span>Species)
<span class="kw">select</span>(iris, <span class="op">-</span>(Petal.Length<span class="op">:</span>Species)) <span class="co">#selects everything, except those cols</span></code></pre></div>
<p>To select 3 columns and rename <em>subject</em> to <em>SUBJ</em> and put liik as the 1st col:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(iris, <span class="dt">liik =</span> Species, Sepal.Length, Sepal.Width) <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">as_data_frame</span>()</code></pre></div>
<pre><code>## # A tibble: 150 x 3
##      liik Sepal.Length Sepal.Width
##    &lt;fctr&gt;        &lt;dbl&gt;       &lt;dbl&gt;
##  1 setosa          5.1         3.5
##  2 setosa          4.9         3.0
##  3 setosa          4.7         3.2
##  4 setosa          4.6         3.1
##  5 setosa          5.0         3.6
##  6 setosa          5.4         3.9
##  7 setosa          4.6         3.4
##  8 setosa          5.0         3.4
##  9 setosa          4.4         2.9
## 10 setosa          4.9         3.1
## # ... with 140 more rows</code></pre>
<p>To select all cols, except sex and value, and rename the <em>subject</em> col:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(iris, <span class="op">-</span>Sepal.Length, <span class="op">-</span>Sepal.Width, <span class="dt">liik =</span> Species)</code></pre></div>
<p><strong>helper functions you can use within select():</strong></p>
<p><code>starts_with(&quot;abc&quot;)</code>: matches names that begin with “abc.”</p>
<p><code>ends_with(&quot;xyz&quot;)</code>: matches names that end with “xyz.”</p>
<p><code>contains(&quot;ijk&quot;)</code>: matches names that contain “ijk.”</p>
<p><code>matches(&quot;(.)\\1&quot;)</code>: selects variables that match a regular expression. This one matches any variables that contain repeated characters.</p>
<p><code>num_range(&quot;x&quot;, 1:3)</code> matches x1, x2 and x3.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(iris)
<span class="kw">select</span>(iris, <span class="kw">starts_with</span>(<span class="st">&quot;Petal&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 150 x 2
##    Petal.Length Petal.Width
##           &lt;dbl&gt;       &lt;dbl&gt;
##  1          1.4         0.2
##  2          1.4         0.2
##  3          1.3         0.2
##  4          1.5         0.2
##  5          1.4         0.2
##  6          1.7         0.4
##  7          1.4         0.3
##  8          1.5         0.2
##  9          1.4         0.2
## 10          1.5         0.1
## # ... with 140 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(iris, <span class="kw">ends_with</span>(<span class="st">&quot;Width&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 150 x 2
##    Sepal.Width Petal.Width
##          &lt;dbl&gt;       &lt;dbl&gt;
##  1         3.5         0.2
##  2         3.0         0.2
##  3         3.2         0.2
##  4         3.1         0.2
##  5         3.6         0.2
##  6         3.9         0.4
##  7         3.4         0.3
##  8         3.4         0.2
##  9         2.9         0.2
## 10         3.1         0.1
## # ... with 140 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Move Species variable to the front</span>
<span class="kw">select</span>(iris, Species, <span class="kw">everything</span>())</code></pre></div>
<pre><code>## # A tibble: 150 x 5
##    Species Sepal.Length Sepal.Width Petal.Length
##     &lt;fctr&gt;        &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
##  1  setosa          5.1         3.5          1.4
##  2  setosa          4.9         3.0          1.4
##  3  setosa          4.7         3.2          1.3
##  4  setosa          4.6         3.1          1.5
##  5  setosa          5.0         3.6          1.4
##  6  setosa          5.4         3.9          1.7
##  7  setosa          4.6         3.4          1.4
##  8  setosa          5.0         3.4          1.5
##  9  setosa          4.4         2.9          1.4
## 10  setosa          4.9         3.1          1.5
## # ... with 140 more rows, and 1 more variables:
## #   Petal.Width &lt;dbl&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">matrix</span>(<span class="kw">runif</span>(<span class="dv">100</span>), <span class="dt">nrow =</span> <span class="dv">10</span>))
dat &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(dat[<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">1</span>, <span class="dv">9</span>, <span class="dv">8</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">10</span>)])
<span class="kw">select</span>(dat, V9<span class="op">:</span>V6)</code></pre></div>
<pre><code>## # A tibble: 10 x 5
##          V9      V8      V5       V2      V6
##       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
##  1 0.877781 0.18312 0.45078 0.001344 0.47636
##  2 0.476330 0.17310 0.15425 0.684717 0.71966
##  3 0.063831 0.68195 0.82482 0.038198 0.84313
##  4 0.243152 0.31417 0.76069 0.556393 0.64210
##  5 0.005896 0.91751 0.50778 0.357616 0.08413
##  6 0.975002 0.40775 0.92881 0.403115 0.93476
##  7 0.239619 0.51386 0.79697 0.645996 0.15764
##  8 0.563414 0.69542 0.89111 0.157689 0.57536
##  9 0.386890 0.09808 0.38038 0.108587 0.49071
## 10 0.257517 0.75442 0.04373 0.560223 0.71875</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(dat, <span class="kw">num_range</span>(<span class="st">&quot;V&quot;</span>, <span class="dv">9</span><span class="op">:</span><span class="dv">6</span>))</code></pre></div>
<pre><code>## # A tibble: 10 x 4
##          V9      V8     V7      V6
##       &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
##  1 0.877781 0.18312 0.9390 0.47636
##  2 0.476330 0.17310 0.5212 0.71966
##  3 0.063831 0.68195 0.2238 0.84313
##  4 0.243152 0.31417 0.8222 0.64210
##  5 0.005896 0.91751 0.8430 0.08413
##  6 0.975002 0.40775 0.5577 0.93476
##  7 0.239619 0.51386 0.6080 0.15764
##  8 0.563414 0.69542 0.1877 0.57536
##  9 0.386890 0.09808 0.4680 0.49071
## 10 0.257517 0.75442 0.6480 0.71875</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Drop variables with -</span>
<span class="kw">select</span>(iris, <span class="op">-</span><span class="kw">starts_with</span>(<span class="st">&quot;Petal&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 150 x 3
##    Sepal.Length Sepal.Width Species
##           &lt;dbl&gt;       &lt;dbl&gt;  &lt;fctr&gt;
##  1          5.1         3.5  setosa
##  2          4.9         3.0  setosa
##  3          4.7         3.2  setosa
##  4          4.6         3.1  setosa
##  5          5.0         3.6  setosa
##  6          5.4         3.9  setosa
##  7          4.6         3.4  setosa
##  8          5.0         3.4  setosa
##  9          4.4         2.9  setosa
## 10          4.9         3.1  setosa
## # ... with 140 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Renaming -----------------------------------------</span>
<span class="co"># select() keeps only the variables you specify</span>
<span class="co"># rename() keeps all variables</span>
<span class="kw">rename</span>(iris, <span class="dt">petal_length =</span> Petal.Length)</code></pre></div>
<pre><code>## # A tibble: 150 x 5
##    Sepal.Length Sepal.Width petal_length Petal.Width
##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
##  1          5.1         3.5          1.4         0.2
##  2          4.9         3.0          1.4         0.2
##  3          4.7         3.2          1.3         0.2
##  4          4.6         3.1          1.5         0.2
##  5          5.0         3.6          1.4         0.2
##  6          5.4         3.9          1.7         0.4
##  7          4.6         3.4          1.4         0.3
##  8          5.0         3.4          1.5         0.2
##  9          4.4         2.9          1.4         0.2
## 10          4.9         3.1          1.5         0.1
## # ... with 140 more rows, and 1 more variables:
## #   Species &lt;fctr&gt;</code></pre>
</div>
<div id="filter-rows" class="section level3">
<h3><span class="header-section-number">8.2.2</span> <code>filter()</code> rows</h3>
<p>Keep rows in Iris that have Species level “setosa” <strong>and</strong> Sepal.Length value &lt;4.5.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(iris, Species<span class="op">==</span><span class="st">&quot;setosa&quot;</span> <span class="op">&amp;</span><span class="st"> </span>Sepal.Length <span class="op">&lt;</span><span class="st"> </span><span class="fl">4.5</span>)</code></pre></div>
<pre><code>## # A tibble: 4 x 5
##   Sepal.Length Sepal.Width Petal.Length Petal.Width
##          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
## 1          4.4         2.9          1.4         0.2
## 2          4.3         3.0          1.1         0.1
## 3          4.4         3.0          1.3         0.2
## 4          4.4         3.2          1.3         0.2
## # ... with 1 more variables: Species &lt;fctr&gt;</code></pre>
<p>Keep rows in Iris that have Species level “setosa” <strong>or</strong> Sepal.Length value &lt;4.5.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(iris, Species<span class="op">==</span><span class="st">&quot;setosa&quot;</span> <span class="op">|</span><span class="st"> </span>Sepal.Length <span class="op">&lt;</span><span class="st"> </span><span class="fl">4.5</span>)</code></pre></div>
<pre><code>## # A tibble: 50 x 5
##    Sepal.Length Sepal.Width Petal.Length Petal.Width
##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
##  1          5.1         3.5          1.4         0.2
##  2          4.9         3.0          1.4         0.2
##  3          4.7         3.2          1.3         0.2
##  4          4.6         3.1          1.5         0.2
##  5          5.0         3.6          1.4         0.2
##  6          5.4         3.9          1.7         0.4
##  7          4.6         3.4          1.4         0.3
##  8          5.0         3.4          1.5         0.2
##  9          4.4         2.9          1.4         0.2
## 10          4.9         3.1          1.5         0.1
## # ... with 40 more rows, and 1 more variables:
## #   Species &lt;fctr&gt;</code></pre>
<p>Keep rows in Iris that have Species level “not setosa” <strong>or</strong> Sepal.Length value &lt;4.5.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(iris, Species <span class="op">!=</span><span class="st">&quot;setosa&quot;</span> <span class="op">|</span><span class="st"> </span>Sepal.Length <span class="op">&lt;</span><span class="st"> </span><span class="fl">4.5</span>)</code></pre></div>
<pre><code>## # A tibble: 104 x 5
##    Sepal.Length Sepal.Width Petal.Length Petal.Width
##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
##  1          4.4         2.9          1.4         0.2
##  2          4.3         3.0          1.1         0.1
##  3          4.4         3.0          1.3         0.2
##  4          4.4         3.2          1.3         0.2
##  5          7.0         3.2          4.7         1.4
##  6          6.4         3.2          4.5         1.5
##  7          6.9         3.1          4.9         1.5
##  8          5.5         2.3          4.0         1.3
##  9          6.5         2.8          4.6         1.5
## 10          5.7         2.8          4.5         1.3
## # ... with 94 more rows, and 1 more variables:
## #   Species &lt;fctr&gt;</code></pre>
<p>Kui tahame samast veerust filtreerida “või” ehk “|” abil mitu väärtust, on meil valida kahe samaväärse variandi vahel (tegelikult töötab 2. variant ka ühe väärtuse korral)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(iris, Species <span class="op">==</span><span class="st">&quot;setosa&quot;</span> <span class="op">|</span><span class="st"> </span>Species <span class="op">==</span><span class="st">&quot;versicolor&quot;</span>)
<span class="kw">filter</span>(iris, Species <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;setosa&quot;</span>, <span class="st">&quot;versicolor&quot;</span>) )</code></pre></div>
<p>Nagu näha, 2. variant on oluliselt lühem.</p>
<p>Filtering with regular expression: we keep the rows where <em>subject</em> starts with the letter “T”</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(stringr)
<span class="kw">filter</span>(iris, <span class="kw">str_detect</span>(Species, <span class="st">&quot;^v&quot;</span>)) </code></pre></div>
<pre><code>## # A tibble: 100 x 5
##    Sepal.Length Sepal.Width Petal.Length Petal.Width
##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
##  1          7.0         3.2          4.7         1.4
##  2          6.4         3.2          4.5         1.5
##  3          6.9         3.1          4.9         1.5
##  4          5.5         2.3          4.0         1.3
##  5          6.5         2.8          4.6         1.5
##  6          5.7         2.8          4.5         1.3
##  7          6.3         3.3          4.7         1.6
##  8          4.9         2.4          3.3         1.0
##  9          6.6         2.9          4.6         1.3
## 10          5.2         2.7          3.9         1.4
## # ... with 90 more rows, and 1 more variables:
## #   Species &lt;fctr&gt;</code></pre>
<p>As you can see there are endless vistas here, open for a regular expression fanatic. I wish I was one!</p>
<p>remove NAs with <code>filter()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(flights, <span class="op">!</span><span class="kw">is.na</span>(dep_delay), <span class="op">!</span><span class="kw">is.na</span>(arr_delay))</code></pre></div>
</div>
<div id="summarise" class="section level3">
<h3><span class="header-section-number">8.2.3</span> <code>summarise()</code></h3>
<p>Many rows summarised to a single value</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarise</span>(iris, 
          <span class="dt">MEAN =</span> <span class="kw">mean</span>(Sepal.Length), 
          <span class="dt">SD =</span> <span class="kw">sd</span>(Sepal.Length), 
          <span class="dt">N =</span> <span class="kw">n</span>(), 
          <span class="dt">n_species =</span> <span class="kw">n_distinct</span>(Species))</code></pre></div>
<pre><code>## # A tibble: 1 x 4
##    MEAN     SD     N n_species
##   &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;     &lt;int&gt;
## 1 5.843 0.8281   150         3</code></pre>
<p><code>n()</code> loeb üles, mitu väärtust läks selle summary statistic-u arvutusse,</p>
<p><code>n_distinct()</code> loeb üles, mitu unikaalset väärtust läks samasse arvutusse.</p>
<p>summarise on kasulikum, kui teda kasutada koos järgmise verbi, group_by-ga.</p>
</div>
<div id="group_by" class="section level3">
<h3><span class="header-section-number">8.2.4</span> <code>group_by()</code></h3>
<p><code>group_by()</code> groups values for summarising or mutating-</p>
<p>When we summarise by <em>sex</em> we will get two values for each summary statistic: for males and females. Aint that sexy?!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris_grouped &lt;-<span class="st"> </span><span class="kw">group_by</span>(iris, Species) 
<span class="kw">summarise</span>(iris_grouped, 
          <span class="dt">MEAN =</span> <span class="kw">mean</span>(Sepal.Length), 
          <span class="dt">SD =</span> <span class="kw">sd</span>(Sepal.Length), 
          <span class="dt">N =</span> <span class="kw">n</span>(), 
          <span class="dt">n_species =</span> <span class="kw">n_distinct</span>(Species))</code></pre></div>
<pre><code>## # A tibble: 3 x 5
##      Species  MEAN     SD     N n_species
##       &lt;fctr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;     &lt;int&gt;
## 1     setosa 5.006 0.3525    50         1
## 2 versicolor 5.936 0.5162    50         1
## 3  virginica 6.588 0.6359    50         1</code></pre>
<p><code>summarise()</code> argumendid on indentsed eelmise näitega aga tulemus ei ole. Siin me rakendame summarise verbi mitte kogu tabelile, vaid 3-le virtuaalsele tabelile, mis on saadud algsest tabelist.</p>
<p><code>group_by()</code>-le saab anda järjest mitu grupeerivat muutujat. Siis ta grupeerib kõigepealt neist esimese järgi, seejärel lõõb saadud grupid omakorda lahku teise argumendi järgi ja nii edasi kuni teie poolt antud argumendid otsa saavad.</p>
<p>Now we group previously generated dat_lng data frame first by <em>sex</em> and then inside each group again by <em>experiment</em>. This is getting complicated …</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat_lng</code></pre></div>
<pre><code>## # A tibble: 9 x 4
##   subject   sex   experiment value
##     &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt;
## 1     Tim     M      control    23
## 2     Ann     F      control    31
## 3    Jill     F      control    30
## 4     Tim     M experiment_1    34
## 5     Ann     F experiment_1    38
## 6    Jill     F experiment_1    36
## 7     Tim     M experiment_2    40
## 8     Ann     F experiment_2    42
## 9    Jill     F experiment_2    44</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">group_by</span>(dat_lng, sex, experiment) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">MEAN =</span> <span class="kw">mean</span>(value), 
            <span class="dt">SD =</span> <span class="kw">sd</span>(value),
            <span class="dt">N =</span> <span class="kw">n</span>(), 
            <span class="dt">n_sex =</span> <span class="kw">n_distinct</span>(sex))</code></pre></div>
<pre><code>## # A tibble: 6 x 6
## # Groups:   sex [?]
##     sex   experiment  MEAN     SD     N n_sex
##   &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
## 1     F      control  30.5 0.7071     2     1
## 2     F experiment_1  37.0 1.4142     2     1
## 3     F experiment_2  43.0 1.4142     2     1
## 4     M      control  23.0     NA     1     1
## 5     M experiment_1  34.0     NA     1     1
## 6     M experiment_2  40.0     NA     1     1</code></pre>
<p>Now we group first by sex and then by variable. Spot the difference!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">group_by</span>(dat_lng, experiment, sex) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">MEAN =</span> <span class="kw">mean</span>(value), 
            <span class="dt">SD =</span> <span class="kw">sd</span>(value),
            <span class="dt">N =</span> <span class="kw">n</span>(), 
            <span class="dt">n_sex =</span> <span class="kw">n_distinct</span>(sex))</code></pre></div>
<pre><code>## # A tibble: 6 x 6
## # Groups:   experiment [?]
##     experiment   sex  MEAN     SD     N n_sex
##          &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
## 1      control     F  30.5 0.7071     2     1
## 2      control     M  23.0     NA     1     1
## 3 experiment_1     F  37.0 1.4142     2     1
## 4 experiment_1     M  34.0     NA     1     1
## 5 experiment_2     F  43.0 1.4142     2     1
## 6 experiment_2     M  40.0     NA     1     1</code></pre>
<p><em>pro tip</em> if you want to summarise and then display the summary values as new column(s), which are added to the original non-shrunk df, use <code>mutate()</code> instead of <code>summarise()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(iris_grouped,
       <span class="dt">MEAN =</span> <span class="kw">mean</span>(Sepal.Length), 
       <span class="dt">SD =</span> <span class="kw">sd</span>(Sepal.Length))</code></pre></div>
<pre><code>## # A tibble: 150 x 7
## # Groups:   Species [3]
##    Sepal.Length Sepal.Width Petal.Length Petal.Width
##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
##  1          5.1         3.5          1.4         0.2
##  2          4.9         3.0          1.4         0.2
##  3          4.7         3.2          1.3         0.2
##  4          4.6         3.1          1.5         0.2
##  5          5.0         3.6          1.4         0.2
##  6          5.4         3.9          1.7         0.4
##  7          4.6         3.4          1.4         0.3
##  8          5.0         3.4          1.5         0.2
##  9          4.4         2.9          1.4         0.2
## 10          4.9         3.1          1.5         0.1
## # ... with 140 more rows, and 3 more variables:
## #   Species &lt;fctr&gt;, MEAN &lt;dbl&gt;, SD &lt;dbl&gt;</code></pre>
<p>Anna igast grupist 3 kõrgeimat väärtust ja 2 madalaimat väärtust. Samad numbrid erinevates ridades antakse kõik - selle pärast on meil tabelis rohkem ridu.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">top_n</span>(iris_grouped, <span class="dv">3</span>, Sepal.Length)
<span class="kw">top_n</span>(iris_grouped, <span class="op">-</span><span class="dv">2</span>, Sepal.Length)</code></pre></div>
</div>
<div id="mutate" class="section level3">
<h3><span class="header-section-number">8.2.5</span> <code>mutate()</code></h3>
<p>Mutate põhikasutus on siiski uute veergude tekitamine, mis võtavad endale inputi rea kaupa. Seega tabeli ridade arv ei muutu.</p>
<p>If in your tibble called ‘df’ you have a column called ‘value’, you can create a new log2 transformed value value column called log_value by <code>df %&gt;% mutate(log_value = log2(value))</code>. Or you can create a new column where a constant is substracted from the value column: <code>df %&gt;% mutate(centered_value = value - mean(value) )</code>. Here the mean value is substracted from each individual value.</p>
<p><strong>Mutate adds new columns (and <code>transmute()</code> creates new columns while losing the previous columns)</strong></p>
<p>Here we firstly create a new column, which contains log-transformed values from the <em>value</em> column, and name it <em>log_value</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(dat_lng, <span class="dt">log_value =</span> <span class="kw">log</span>(value))</code></pre></div>
<pre><code>## # A tibble: 9 x 5
##   subject   sex   experiment value log_value
##     &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1     Tim     M      control    23     3.135
## 2     Ann     F      control    31     3.434
## 3    Jill     F      control    30     3.401
## 4     Tim     M experiment_1    34     3.526
## 5     Ann     F experiment_1    38     3.638
## 6    Jill     F experiment_1    36     3.584
## 7     Tim     M experiment_2    40     3.689
## 8     Ann     F experiment_2    42     3.738
## 9    Jill     F experiment_2    44     3.784</code></pre>
<p>The same with transmute: note the dropping of some of the original cols, keeping the original <em>subject</em> col and renaming the <em>sex</em> col.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">transmute</span>(dat_lng, subject, <span class="dt">gender =</span> sex, <span class="dt">log_value =</span> <span class="kw">log</span>(value))</code></pre></div>
<pre><code>## # A tibble: 9 x 3
##   subject gender log_value
##     &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;
## 1     Tim      M     3.135
## 2     Ann      F     3.434
## 3    Jill      F     3.401
## 4     Tim      M     3.526
## 5     Ann      F     3.638
## 6    Jill      F     3.584
## 7     Tim      M     3.689
## 8     Ann      F     3.738
## 9    Jill      F     3.784</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights_sml &lt;-<span class="st"> </span><span class="kw">select</span>(flights, 
                      year<span class="op">:</span>day, 
                      <span class="kw">ends_with</span>(<span class="st">&quot;delay&quot;</span>), 
                      distance, 
                      air_time) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gain =</span> arr_delay <span class="op">-</span><span class="st"> </span>dep_delay,
    <span class="dt">hours =</span> air_time <span class="op">/</span><span class="st"> </span><span class="dv">60</span>,
    <span class="dt">gain_per_hour =</span> gain <span class="op">/</span><span class="st"> </span>hours)</code></pre></div>
<p><em><code>mutate_all()</code>, <code>mutate_if()</code> and <code>mutate_at()</code> and the three variants of <code>transmute()</code> (<code>transmute_all()</code>, <code>transmute_if()</code>, <code>transmute_at()</code>) make it easy to apply a transformation to a selection of variables. See help.</em></p>
<p>Here we first group and then mutate. Note that now, instead of a single constant, we divide by as many different constant as there are discrete factor levels in the sex variable (two, in our case):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">group_by</span>(dat_lng, sex) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">norm_value =</span> value <span class="op">/</span><span class="st"> </span><span class="kw">mean</span>(value), 
         <span class="dt">n2_val =</span> value <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(value))</code></pre></div>
<pre><code>## # A tibble: 9 x 6
## # Groups:   sex [2]
##   subject   sex   experiment value norm_value n2_val
##     &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;
## 1     Tim     M      control    23     0.7113  2.668
## 2     Ann     F      control    31     0.8416  5.466
## 3    Jill     F      control    30     0.8145  5.290
## 4     Tim     M experiment_1    34     1.0515  3.944
## 5     Ann     F experiment_1    38     1.0317  6.700
## 6    Jill     F experiment_1    36     0.9774  6.347
## 7     Tim     M experiment_2    40     1.2371  4.639
## 8     Ann     F experiment_2    42     1.1403  7.405
## 9    Jill     F experiment_2    44     1.1946  7.758</code></pre>
<p>Compare with a “straight” mutate to see the difference in values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(dat_lng, 
       <span class="dt">norm_value =</span> value <span class="op">/</span><span class="st"> </span><span class="kw">mean</span>(value), 
       <span class="dt">n2_val =</span> value <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(value))</code></pre></div>
<pre><code>## # A tibble: 9 x 6
##   subject   sex   experiment value norm_value n2_val
##     &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;
## 1     Tim     M      control    23     0.6509  3.477
## 2     Ann     F      control    31     0.8774  4.687
## 3    Jill     F      control    30     0.8491  4.536
## 4     Tim     M experiment_1    34     0.9623  5.140
## 5     Ann     F experiment_1    38     1.0755  5.745
## 6    Jill     F experiment_1    36     1.0189  5.443
## 7     Tim     M experiment_2    40     1.1321  6.047
## 8     Ann     F experiment_2    42     1.1887  6.350
## 9    Jill     F experiment_2    44     1.2453  6.652</code></pre>
</div>
</div>
<div id="grouped-filters" class="section level2">
<h2><span class="header-section-number">8.3</span> Grouped filters</h2>
<p>Keep all groups bigger than a threshold:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">popular_dests &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">365</span>)</code></pre></div>
<p>If you need to remove grouping, and return to operations on ungrouped data, use <code>ungroup()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ungroup</span>(dat) </code></pre></div>
<p><code>str_replace_all()</code> helps to deal with unruly labelling inside columns containing strings</p>
<p>The idea is to find a pattern in a collection of strings and replace it with something else. String == character vector.</p>
<p>To find and replace we use <code>str_replace_all()</code>, whose base R analogue is <code>gsub()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(stringr)
(bad.df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">time =</span> <span class="kw">c</span>(<span class="st">&quot;t0&quot;</span>, <span class="st">&quot;t1&quot;</span>, <span class="st">&quot;t12&quot;</span>), <span class="dt">value =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">9</span>)))</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##    time value
##   &lt;chr&gt; &lt;dbl&gt;
## 1    t0     2
## 2    t1     4
## 3   t12     9</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">get_numeric &lt;-<span class="st"> </span><span class="cf">function</span>(x, ...) <span class="kw">as.numeric</span>(<span class="kw">str_replace_all</span>(x, ...))
(bad.df &lt;-<span class="st"> </span><span class="kw">mutate_at</span>(bad.df, <span class="st">&quot;time&quot;</span>, get_numeric, <span class="dt">pattern =</span> <span class="st">&quot;t&quot;</span>, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##    time value
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     0     2
## 2     1     4
## 3    12     9</code></pre>
<p>now we have a numeric time column, which can be used in plotting.</p>
<p>or</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)
(bad.df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">time =</span> <span class="kw">c</span>(<span class="st">&quot;t0&quot;</span>, <span class="st">&quot;t1&quot;</span>, <span class="st">&quot;t12&quot;</span>), <span class="dt">value =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">9</span>)))</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##    time value
##   &lt;chr&gt; &lt;dbl&gt;
## 1    t0     2
## 2    t1     4
## 3   t12     9</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate_at</span>(bad.df, <span class="st">&quot;time&quot;</span>, parse_number)</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##    time value
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     0     2
## 2     1     4
## 3    12     9</code></pre>
<p>Here we did the same thing more elegantly by directly parsing numbers from a character string.</p>
</div>
<div id="separate-one-column-into-several" class="section level2">
<h2><span class="header-section-number">8.4</span> <code>separate()</code> one column into several</h2>
<p>Siin on veel üks verb, mida aeg-ajalt kõigil vaja läheb. <code>separate()</code> võtab ühe veeru sisu (mis peab olema character string) ning jagab selle laiali mitme uue veeru vahel. Kui teda kasutada vormis <code>separate(df, old_Column, into=c(&quot;new_col1&quot;, &quot;new_col2&quot;, &quot;ja_nii_edasi&quot;))</code> siis püüab programm ise ära arvata, kustkohalt veeru sisu hakkida (tühikud, komad, semikoolonid, koolonid jne). Aga te võite eksplitsiitselt ette anda separaatori sep = “”. sep = 2 tähendab “peale 2. tähemärki”. sep = -6 tähendab “enne tagantpoolt 6. tähemärki”</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(dat &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">country =</span> <span class="kw">c</span>(<span class="st">&quot;Albania&quot;</span>), <span class="dt">disease.cases =</span> <span class="kw">c</span>(<span class="st">&quot;80/1000&quot;</span>)))</code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   country disease.cases
##     &lt;chr&gt;         &lt;chr&gt;
## 1 Albania       80/1000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(df.sep &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(disease.cases, <span class="dt">into=</span><span class="kw">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;thousand&quot;</span>)))</code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   country cases thousand
## *   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;
## 1 Albania    80     1000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(df.sep &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(disease.cases, <span class="dt">into=</span><span class="kw">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;thousand&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;/&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   country cases thousand
## *   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;
## 1 Albania    80     1000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(df.sep &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(disease.cases, <span class="dt">into=</span><span class="kw">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;thousand&quot;</span>), <span class="dt">sep =</span> <span class="dv">2</span>))</code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   country cases thousand
## *   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;
## 1 Albania    80    /1000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(df.sep &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(disease.cases, <span class="dt">into=</span><span class="kw">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;thousand&quot;</span>), <span class="dt">sep =</span> <span class="op">-</span><span class="dv">6</span>))</code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   country cases thousand
## *   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;
## 1 Albania    80    /1000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(dat &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">index =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), 
               <span class="dt">taxon =</span> <span class="kw">c</span>(<span class="st">&quot;Procaryota; Bacteria; Alpha-Proteobacteria; Escharichia&quot;</span>, <span class="st">&quot;Eukaryota; Chordata&quot;</span>)))</code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   index
##   &lt;dbl&gt;
## 1     1
## 2     2
## # ... with 1 more variables: taxon &lt;chr&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(d1 &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(taxon, <span class="kw">c</span>(<span class="st">&#39;riik&#39;</span>, <span class="st">&#39;hmk&#39;</span>, <span class="st">&quot;klass&quot;</span>, <span class="st">&quot;perekond&quot;</span>), <span class="dt">sep =</span> <span class="st">&#39;; &#39;</span>, <span class="dt">extra =</span> <span class="st">&quot;merge&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;right&quot;</span>)) </code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   index       riik      hmk                klass
## * &lt;dbl&gt;      &lt;chr&gt;    &lt;chr&gt;                &lt;chr&gt;
## 1     1 Procaryota Bacteria Alpha-Proteobacteria
## 2     2  Eukaryota Chordata                 &lt;NA&gt;
## # ... with 1 more variables: perekond &lt;chr&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># some special cases:</span>
(dat &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">index =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), 
               <span class="dt">taxon =</span> <span class="kw">c</span>(<span class="st">&quot;Prokaryota || Bacteria || Alpha-Proteobacteria || Escharichia&quot;</span>, <span class="st">&quot;Eukaryota || Chordata&quot;</span>)))</code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   index
##   &lt;dbl&gt;
## 1     1
## 2     2
## # ... with 1 more variables: taxon &lt;chr&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(d1 &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(taxon, <span class="kw">c</span>(<span class="st">&quot;riik&quot;</span>, <span class="st">&quot;hmk&quot;</span>, <span class="st">&quot;klass&quot;</span>, <span class="st">&quot;perekond&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">|</span><span class="ch">\\</span><span class="st">|&quot;</span>, <span class="dt">extra =</span> <span class="st">&quot;merge&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;right&quot;</span>)) </code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   index        riik        hmk                  klass
## * &lt;dbl&gt;       &lt;chr&gt;      &lt;chr&gt;                  &lt;chr&gt;
## 1     1 Prokaryota   Bacteria   Alpha-Proteobacteria 
## 2     2  Eukaryota    Chordata                   &lt;NA&gt;
## # ... with 1 more variables: perekond &lt;chr&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">index =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), 
              <span class="dt">taxon =</span> <span class="kw">c</span>(<span class="st">&quot;Prokaryota.Bacteria.Alpha-Proteobacteria.Escharichia&quot;</span>, <span class="st">&quot;Eukaryota.Chordata&quot;</span>))
(d1 &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(taxon, <span class="kw">c</span>(<span class="st">&#39;riik&#39;</span>, <span class="st">&#39;hmk&#39;</span>, <span class="st">&quot;klass&quot;</span>, <span class="st">&quot;perekond&quot;</span>), <span class="dt">sep =</span> <span class="st">&#39;[.]&#39;</span>, <span class="dt">extra =</span> <span class="st">&quot;merge&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;right&quot;</span>)) </code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   index       riik      hmk                klass
## * &lt;dbl&gt;      &lt;chr&gt;    &lt;chr&gt;                &lt;chr&gt;
## 1     1 Prokaryota Bacteria Alpha-Proteobacteria
## 2     2  Eukaryota Chordata                 &lt;NA&gt;
## # ... with 1 more variables: perekond &lt;chr&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(dat &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">index =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), 
               <span class="dt">taxon =</span> <span class="kw">c</span>(<span class="st">&quot;Prokaryota.Bacteria,Alpha-Proteobacteria.Escharichia&quot;</span>, <span class="st">&quot;Eukaryota.Chordata&quot;</span>)))</code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   index
##   &lt;dbl&gt;
## 1     1
## 2     2
## # ... with 1 more variables: taxon &lt;chr&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(d1 &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(taxon, <span class="kw">c</span>(<span class="st">&#39;riik&#39;</span>, <span class="st">&#39;hmk&#39;</span>, <span class="st">&quot;klass&quot;</span>, <span class="st">&quot;perekond&quot;</span>), <span class="dt">sep =</span> <span class="st">&#39;[,</span><span class="ch">\\</span><span class="st">.]&#39;</span>, <span class="dt">extra =</span> <span class="st">&quot;merge&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;right&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   index       riik      hmk                klass
## * &lt;dbl&gt;      &lt;chr&gt;    &lt;chr&gt;                &lt;chr&gt;
## 1     1 Prokaryota Bacteria Alpha-Proteobacteria
## 2     2  Eukaryota Chordata                 &lt;NA&gt;
## # ... with 1 more variables: perekond &lt;chr&gt;</code></pre>
<p>The companion FUN to separate is <code>unite()</code> - see help.</p>
</div>
<div id="faktorid" class="section level2">
<h2><span class="header-section-number">8.5</span> Faktorid</h2>
<p>Faktor on andmetüüp, mis oli ajalooliselt tähtsam kui ta praegu on. Sageli saame oma asja ära ajada character vectori andmetüübiga ja ei vaja faktorit. Aga siiski läheb faktoreid aeg-ajalt kõigil vaja.</p>
<blockquote>
<p>Faktorite abil töötame kategooriliste muutujatega, millel on fikseeritud hulk võimalikke väärtusi, mida me kõiki teame.</p>
</blockquote>
<p>Faktori väärtusi kutsutakse “tasemeteks” (levels). Näiteks: muutuja sex on 2 tasemega faktor (M, F)</p>
<p><strong>NB! Faktoriks muutes saame character vectori liikmete järjekorra muuta mitte-tähestikuliseks</strong></p>
<p>Me kasutame faktoritega töötamisel forcats paketti. Kõigepealt loome character vectori x1 nelja kuu nime ingliskeelse lühendiga.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(forcats)
x1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Dec&quot;</span>, <span class="st">&quot;Apr&quot;</span>, <span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Mar&quot;</span>)</code></pre></div>
<p>Nüüd kujutlege, et vektor x1 sisaldab 10 000 elementi. Seda vektorit on raske sorteerida, ja trükivead on ka raskesti leitavad. Mõlema probleemi vastu aitab, kui me konverteerime x1-e faktoriks. Selleks, et luua uus faktor, peaks kõigepealt üles lugema selle faktori kõik võimalikud tasemed:</p>
<p>Nüüd loome uue faktori ehk muudame x1 character vektori y1 factor vektoriks. Erinevalt x1-st seostub iga y1 väärtusega faktori tase. Kui algses vektoris on mõni element, millele ei vasta näiteks trükivea tõttu ühtegi faktori taset, siis see element muudetakse NA-ks. Proovige see ise järele, viies trükivea sisse x1-e.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y1 &lt;-<span class="st"> </span><span class="kw">factor</span>(x1, <span class="dt">levels =</span> month.abb)
y1</code></pre></div>
<pre><code>## [1] Dec Apr Jan Mar
## 12 Levels: Jan Feb Mar Apr May Jun Jul Aug Sep ... Dec</code></pre>
<p>NB! <code>month.abb</code> on R objekt mis sisaldab kuude ingliskeelseid lühendeid.</p>
<p><strong>Kui sa faktorile tasemeid ette ei anna, siis need tekivad andmetest automaatselt ja tähestikulises järjekorras.</strong></p>
<p>Kui sa tahad, et faktori tasemed oleks samas järjekorras kui selle taseme esmakordne ilmumine teie andmetes siis:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f2 &lt;-<span class="st"> </span><span class="kw">factor</span>(x1) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fct_inorder</span>()
f2</code></pre></div>
<pre><code>## [1] Dec Apr Jan Mar
## Levels: Dec Apr Jan Mar</code></pre>
<p><code>levels()</code> annab faktori tasemed ja nende järjekorra</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(f2)</code></pre></div>
<pre><code>## [1] &quot;Dec&quot; &quot;Apr&quot; &quot;Jan&quot; &quot;Mar&quot;</code></pre>
<p>Kui faktorid on tibbles oma veeruna, siis saab nende tasemed <code>count()</code> kasutades:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gss_cat <span class="co">#tibble, mille veerg &quot;race&quot; on faktor.</span></code></pre></div>
<pre><code>## # A tibble: 21,483 x 9
##     year       marital   age   race        rincome
##    &lt;int&gt;        &lt;fctr&gt; &lt;int&gt; &lt;fctr&gt;         &lt;fctr&gt;
##  1  2000 Never married    26  White  $8000 to 9999
##  2  2000      Divorced    48  White  $8000 to 9999
##  3  2000       Widowed    67  White Not applicable
##  4  2000 Never married    39  White Not applicable
##  5  2000      Divorced    25  White Not applicable
##  6  2000       Married    25  White $20000 - 24999
##  7  2000 Never married    36  White $25000 or more
##  8  2000      Divorced    44  White  $7000 to 7999
##  9  2000       Married    44  White $25000 or more
## 10  2000       Married    47  White $25000 or more
## # ... with 21,473 more rows, and 4 more variables:
## #   partyid &lt;fctr&gt;, relig &lt;fctr&gt;, denom &lt;fctr&gt;,
## #   tvhours &lt;int&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gss_cat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(race)</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##     race     n
##   &lt;fctr&gt; &lt;int&gt;
## 1  Other  1959
## 2  Black  3129
## 3  White 16395</code></pre>
<p>Nii saame ka teada, mitu korda iga faktori tase selles tabelis esineb.</p>
<div id="fct_recode-rekodeerib-faktori-tasemed" class="section level3">
<h3><span class="header-section-number">8.5.1</span> <code>fct_recode()</code> rekodeerib faktori tasemed</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gss_cat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(partyid)</code></pre></div>
<pre><code>## # A tibble: 10 x 2
##               partyid     n
##                &lt;fctr&gt; &lt;int&gt;
##  1          No answer   154
##  2         Don&#39;t know     1
##  3        Other party   393
##  4  Strong republican  2314
##  5 Not str republican  3032
##  6       Ind,near rep  1791
##  7        Independent  4119
##  8       Ind,near dem  2499
##  9   Not str democrat  3690
## 10    Strong democrat  3490</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gss_cat <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">partyid =</span> <span class="kw">fct_recode</span>(partyid,
                              <span class="st">&quot;Republican, strong&quot;</span>    =<span class="st"> &quot;Strong republican&quot;</span>,
                              <span class="st">&quot;Republican, weak&quot;</span>      =<span class="st"> &quot;Not str republican&quot;</span>,
                              <span class="st">&quot;Independent, near rep&quot;</span> =<span class="st"> &quot;Ind,near rep&quot;</span>,
                              <span class="st">&quot;Independent, near dem&quot;</span> =<span class="st"> &quot;Ind,near dem&quot;</span>,
                              <span class="st">&quot;Democrat, weak&quot;</span>        =<span class="st"> &quot;Not str democrat&quot;</span>,
                              <span class="st">&quot;Democrat, strong&quot;</span>      =<span class="st"> &quot;Strong democrat&quot;</span>,
                              <span class="st">&quot;Other&quot;</span>                 =<span class="st"> &quot;No answer&quot;</span>,
                              <span class="st">&quot;Other&quot;</span>                 =<span class="st"> &quot;Don&#39;t know&quot;</span>,
                              <span class="st">&quot;Other&quot;</span>                 =<span class="st"> &quot;Other party&quot;</span>
  )) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(partyid)</code></pre></div>
<pre><code>## # A tibble: 8 x 2
##                 partyid     n
##                  &lt;fctr&gt; &lt;int&gt;
## 1                 Other   548
## 2    Republican, strong  2314
## 3      Republican, weak  3032
## 4 Independent, near rep  1791
## 5           Independent  4119
## 6 Independent, near dem  2499
## 7        Democrat, weak  3690
## 8      Democrat, strong  3490</code></pre>
<p><code>fct_recode()</code> ei puuduta neid tasemeid, mida selle argumendis ei mainita. Lisaks saab mitu vana taset muuta üheks uueks tasemeks.</p>
</div>
<div id="fct_collapse-annab-argumenti-sisse-vanade-tasemete-vektori-et-teha-vahem-uusi-tasemeid." class="section level3">
<h3><span class="header-section-number">8.5.2</span> <code>fct_collapse()</code> annab argumenti sisse vanade tasemete vektori, et teha vähem uusi tasemeid.</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gss_cat <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">partyid =</span> <span class="kw">fct_collapse</span>(partyid,
                                <span class="dt">other =</span> <span class="kw">c</span>(<span class="st">&quot;No answer&quot;</span>, <span class="st">&quot;Don&#39;t know&quot;</span>, <span class="st">&quot;Other party&quot;</span>),
                                <span class="dt">rep =</span> <span class="kw">c</span>(<span class="st">&quot;Strong republican&quot;</span>, <span class="st">&quot;Not str republican&quot;</span>),
                                <span class="dt">ind =</span> <span class="kw">c</span>(<span class="st">&quot;Ind,near rep&quot;</span>, <span class="st">&quot;Independent&quot;</span>, <span class="st">&quot;Ind,near dem&quot;</span>),
                                <span class="dt">dem =</span> <span class="kw">c</span>(<span class="st">&quot;Not str democrat&quot;</span>, <span class="st">&quot;Strong democrat&quot;</span>)
  )) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(partyid)</code></pre></div>
</div>
<div id="fct_lump-loob-kokku-koik-vahem-arv-kordi-esinevad-tasemed." class="section level3">
<h3><span class="header-section-number">8.5.3</span> <code>fct_lump()</code> lööb kokku kõik vähem arv kordi esinevad tasemed.</h3>
<p>n parameeter ütleb, mitu algset taset tuleb alles jätta:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gss_cat <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">relig =</span> <span class="kw">fct_lump</span>(relig, <span class="dt">n =</span> <span class="dv">5</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(relig, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">print</span>()</code></pre></div>
<pre><code>## # A tibble: 6 x 2
##        relig     n
##       &lt;fctr&gt; &lt;int&gt;
## 1 Protestant 10846
## 2   Catholic  5124
## 3       None  3523
## 4      Other   913
## 5  Christian   689
## 6     Jewish   388</code></pre>
</div>
<div id="rekodeerime-pideva-muutuja-faktoriks" class="section level3">
<h3><span class="header-section-number">8.5.4</span> Rekodeerime pideva muutuja faktoriks</h3>
<p><code>cut()</code> jagab meie muutuja väärtused intervallidesse ja annab igale intervallile faktori taseme.</p>
<p><code>cut(x, breaks, labels = NULL, ordered_result = FALSE, ...)</code></p>
<p>breaks - either a numeric vector of two or more unique cut points or a single number &gt;1, giving the number of intervals into which x is to be cut. labels - labels for the levels of the resulting category. ordered_result - logical: should the result be an ordered factor?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">z &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>
z1 &lt;-<span class="st"> </span><span class="kw">cut</span>(z, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">10</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>))
z1</code></pre></div>
<pre><code>##  [1] A A A B B B C C C C
## Levels: A B C</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Note that to include 1 in level “A” you need to start the first cut &lt;1, while at the right side 3 is included in the 1st cut (in factor level “A”)</span>
z2 &lt;-<span class="st"> </span><span class="kw">cut</span>(z, <span class="dt">breaks =</span> <span class="dv">3</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>))
z2</code></pre></div>
<pre><code>##  [1] A A A A B B B C C C
## Levels: A B C</code></pre>
<p><code>car::recode</code> aitab rekodeerida</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(car) </code></pre></div>
<pre><code>## 
## Attaching package: &#39;car&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     some</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     recode</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">3</span>)
x</code></pre></div>
<pre><code>## [1] 1 2 3 1 2 3 1 2 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">recode</span>(x, <span class="st">&quot;c(1,2) = &#39;A&#39;; else = &#39;B&#39;&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;A&quot; &quot;A&quot; &quot;B&quot; &quot;A&quot; &quot;A&quot; &quot;B&quot; &quot;A&quot; &quot;A&quot; &quot;B&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">recode</span>(x, <span class="st">&quot;c(1,2) = NA&quot;</span>)</code></pre></div>
<pre><code>## [1] NA NA  3 NA NA  3 NA NA  3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">recode</span>(x, <span class="st">&quot;1:2 = &#39;A&#39;; 3 = &#39;B&#39;&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;A&quot; &quot;A&quot; &quot;B&quot; &quot;A&quot; &quot;A&quot; &quot;B&quot; &quot;A&quot; &quot;A&quot; &quot;B&quot;</code></pre>
</div>
<div id="muudame-faktori-tasemete-jarjekorda-joonisel" class="section level3">
<h3><span class="header-section-number">8.5.5</span> Muudame faktori tasemete järjekorda joonisel</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## summeerime andmed
gsscat_sum  &lt;-<span class="st"> </span><span class="kw">group_by</span>(gss_cat, relig) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">age =</span> <span class="kw">mean</span>(age, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
            <span class="dt">tvhours =</span> <span class="kw">mean</span>(tvhours, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
            <span class="dt">n =</span> <span class="kw">n</span>())
## joonistame graafiku
p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(gsscat_sum, <span class="kw">aes</span>(tvhours, <span class="kw">fct_reorder</span>(relig, tvhours))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()
p</code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-231-1.svg" width="672" /></p>
</div>
<div id="fct_relevel-tostab-joonisel-osad-tasemed-teistest-ettepoole" class="section level3">
<h3><span class="header-section-number">8.5.6</span> <code>fct_relevel()</code> tõstab joonisel osad tasemed teistest ettepoole</h3>
<p>Argumendid on faktor f ja need tasemed (jutumärkides), mida sa tahad tõsta.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## täiendame eelmist graafikut ümberkorraldatud andmetega
p <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(tvhours, <span class="kw">fct_relevel</span>(relig, <span class="st">&quot;None&quot;</span>, <span class="st">&quot;Don&#39;t know&quot;</span>))</code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-232-1.svg" width="672" /></p>
</div>
<div id="joontega-plotil-saab-fct_reorder2-abil-assotseerida-y-vaartused-suurimate-x-vaartustega" class="section level3">
<h3><span class="header-section-number">8.5.7</span> Joontega plotil saab <code>fct_reorder2()</code> abil assotseerida y väärtused suurimate x väärtustega</h3>
<p>See muudab ploti paremini jälgitavaks:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## summeerime andmed
gsscat_sum &lt;-<span class="st"> </span><span class="kw">filter</span>(gss_cat, <span class="op">!</span><span class="kw">is.na</span>(age)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(age, marital) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">N=</span><span class="kw">n</span>())
## paneme andmed graafikule
<span class="kw">ggplot</span>(gsscat_sum, <span class="kw">aes</span>(age, N, <span class="dt">colour =</span> <span class="kw">fct_reorder2</span>(marital, age, N))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">colour =</span> <span class="st">&quot;marital&quot;</span>)</code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-233-1.svg" width="672" /></p>
</div>
<div id="tulpdiagrammide-korral-kasuta-fct_infreq" class="section level3">
<h3><span class="header-section-number">8.5.8</span> Tulpdiagrammide korral kasuta <code>fct_infreq()</code></h3>
<p>Loeme kokku erineva perekondliku staatusega isikud ja paneme need andmed tulpdiagrammi grupi suurusele vastupidises järjekorras st. väiksemad grupid tulevad enne.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(gss_cat, <span class="dt">marital =</span> <span class="kw">fct_infreq</span>(marital) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fct_rev</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(marital)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>()</code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-234-1.svg" width="672" /></p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(ggthemes)
<span class="kw">library</span>(scatterplot3d)
<span class="kw">library</span>(modelr)
<span class="kw">library</span>(broom)</code></pre></div>
<pre><code>## 
## Attaching package: &#39;broom&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:modelr&#39;:
## 
##     bootstrap</code></pre>
</div>
</div>
<div id="suur-ja-vaike-maailm" class="section level2">
<h2><span class="header-section-number">8.6</span> Suur ja väike maailm</h2>
<p>Kuna maailmas on kõik kõigega seotud, on seda raske otse uurida. Teadus töötab tänu sellele, et teadlased lõikavad reaalsuse väikesteks tükkideks, kasutades tordilabidana teaduslike hüpoteese, ning uurivad seda tükikaupa lootuses, et kui kõik tükid on korralikult läbi nätsutatud, saab sellest taas tordi kokku panna. Tüüpiline bioloogiline hüpotees pakub välja tavakeelse (mitte matemaatilise) seletuse mõnele piiritletud loodusnähtusele.</p>
<p>Näiteks antibiootikume uuritakse keemilise sideme tasemel kasutades orgaanilise keemia meetodeid. Antibiootikumide molekulaarseid märklaudu uuritakse molekulaarbioloogiliste meetoditega, nende toimet uuritakse rakubioloogia ja füsioloogia meetoditega, aga kaasajal on väga olulised ka ökoloogilised, evolutsioonilised, meditsiinilised, põllumajanduslikud, majanduslikud ja psühholoogilised aspektid. Kõigil neil tasanditel on loodud palju hüpoteese, millest kokku moodustub meie teadmine antibiootikumide kohta. Neid väga erinevaid asju, mida me kutsume hüpoteesideks, ühendab see, et neist igaüht võib võrrelda empiiriliste andmetega. Samuti, enamust neist saab kirjeldada matemaatiliste formalismide ehk mudelite abil, ja neid mudeleid saab omakorda võrrelda andmetega. Kuigi erinevate tasemete hüpoteesid on tavakeeles üksteisest väga erinevad, on neid kirjeldavad mudelid sageli matemaatiliselt sarnased.</p>
<blockquote>
<p>Kui mudel on teooria lihtsustus, siis teooria on maailma lihtsustus.</p>
</blockquote>
<p>Mis juhtub, kui teie hüpotees on andmetega kooskõlas? Kas see tähendab, et see hüpotees vastab tõele? Või, et see on tõenäoliselt tõene? Kahjuks on vastus mõlemale küsimusele eitav. Põhjuseks on asjaolu, et enamasti leiab iga nähtuse seletamiseks rohkem kui ühe alternatiivse teadusliku hüpoteesi ning rohkem kui üks üksteist välistav hüpotees võib olla olemasolevate andmetega võrdses kooskõlas. Asja teeb veelgi hullemaks, et teoreetiliselt on võimalik sõnastada lõpmata palju erinevaid teooriaid, mis kõik pakuvad alternatiivseid ja üksteist välistavaid seletusi samale nähtusele. Kuna hüpoteese on lõpmatu hulk, aga andmeid on alalti lõplik hulk, siis saab igas teaduslikus “faktis” kahelda.<br />
Kunagi ei või kindel olla, et parimad teooriad ei ole täiesti tähelepanuta jäänud ning, et meie poolt kogutud vähesed andmed kajastavad hästi kõiki võimalikke andmeid.</p>
<blockquote>
<p>Ca. 1910 mõtlesid filosoofid Russell ja Moore välja tõe vastavusteooria, mille kohaselt tõest propositsiooni eristab väärast “vastavus” füüsikalisele maailmale. Selle kohaselt on tõesed need laused, mis vastavad asjadele. Ehkki keegi ei oska siiani öelda, mida “vastavus” selles kontekstis ikkagi tähendab, või kuidas seda saavutada, on vastavusteooria senini kõige populaarsem tõeteooria filosoofide hulgas (mis on kõnekas alternatiivide kohta). Samamoodi, kui lausete vastavusest maailmaga, võime rääkida ka võrrandite (ehk mudelite) vastavusest lausetega. Vastavusest lausetaga sellepärast, et mudelid on koostatud teaduslike teooriate, mitte otse maailma, kirjeldusena. Seega ei pea me muretsema mudelite tõeväärtuse pärast. Võib lausa väita, et mudeli tõeväärtusest rääkimine on kohatu.</p>
</blockquote>
<p>Teeoria ja mudeli seose kohta selline näide. Meil on hüpotees, mille kohaselt valijad eelistavad demokraatlikus süsteemis kandidaate, kes on ennast juba tõestanud sellega, et saavad hakkama riigi majanduse edendamisega. Seega, kompetentsed poliitikud valitakse tagasi. Sellest hüpoteesist saab tuletada kaks järelmit 1. - majandusel läheb keskmiselt paremini juba tagasi valitud poliitikute all kui esimest korda valitud poliitkute all, keda ei ole veel elektoraadi poolt harvendatud ja 2. - majandusnäitajate varieeruvus on esimesel juhul väiksem, sest kehvemad poliitikud on juba valija poolt valimist eemaldatud (Achen, C. H., &amp; Bartels, L. M. (2016). Democracy for Realists). Esimese järelmi testimiseks kasutati statistilise mudelina aritmeetilist keskmist koos standardveaga ja teise järelmi jaoks standardhälvet. Tulemused olid vastupidised hüpoteesi poolt ennustatutega. Seega: andmed (kas neid on piisavalt? on nad representatiivsed?) –&gt; mudel (kindlasti on siin alternatiivseid võimalusi sama küsimuse modelleerimiseks) –&gt; teooria järelm (sama teooria annab ka teisi järelmeid. Mis juhtub, kui osad neist on andmetega kooskõlas ja teised ei ole?) –&gt; laiem teooria –&gt; järeldus demokraatia toimimise kohta laias maailmas.</p>
</div>
<div id="mudeli-vaike-maailm" class="section level2">
<h2><span class="header-section-number">8.7</span> Mudeli väike maailm</h2>
<p>Ülalmainitud teadusliku meetodi puudused tingivad, et meie huvides on oma teaduslikke probleeme veel ühe taseme võrra lihtsustada, taandades need statistilisteks probleemideks. Selleks tuletame tavakeelsest teaduslikust teooriast täpselt formuleeritud matemaatilise mudeli ning seejärel asume uurima oma mudelit lootuses, et mudeli kooskõla andmetega ütleb meile midagi teadusliku hüpoteesi kohta. Enamasti töötab selline lähenemine siis, kui mudeli ehitamisel arvestati võimaliku andmeid genereeriva mehhanismiga – ehk, kui mudeli matemaatiline struktuur koostati teaduslikku hüpoteesi silmas pidades. Mudelid, mis ehitatakse silmas pidades puhtalt matemaatilist sobivust andmetega, ei kipu omama teaduslikku seletusjõudu, kuigi neil võib olla väga hea ennustusjõud.</p>
<blockquote>
<p>Meil on kaks hüpoteesi, A ja B. Juhul kui A on tõene ja B on väär, kas on võimalik, et B on tõele lähemal kui A? Kui A ja B on teineteist välistavad punkthüpoteesid parameetri väärtuse kohta, siis on vastus eitav. Aga mis juhtub, kui A ja B on statistilised mudelid? Näiteks, kui tõde on, et eesti meeste keskmine pikkus on 178.3 cm ja A ütleb, et keskmine pikkus jääb kuhugi 150 cm ja 220 cm vahele ning B ütleb, et see jääb kuhugi 179 cm ja 182 cm vahele, siis on B tõele lähemal selles mõttes, et meil on temast teaduslikus mõttes rohkem kasu. Siit on näha oluline erinevus teadusliku hüpoteesi ja statistilise mudeli vahel: hüpotees on orienteeritud tõele, samal ajal kui mudel on orienteeritud kasule.</p>
</blockquote>
<p>Mudeli maailm erineb päris maailmast selle poolest, et mudeli maailmas on kõik sündmused, mis põhimõtteliselt võivad juhtuda, juba ette teada ja üles loendatud (seda sündmuste kogu kutsutakse parameetriruumiks). Tehniliselt on mudeli maailmas üllatused võimatud. Lisaks, tõenäosusteooriat, ja eriti Bayesi teoreemi, kasutades on meil garantii, et me suudame mudelis leiduva informatsiooniga ümber käia parimal võimalikul viisil. Kõik see rõõm jääb siiski mudeli piiridesse. Mudeli eeliseks teooria ees on, et hästi konstrueeritud mudel on lihtsamini mõistetav — erinevalt vähegi keerulisemast teaduslikust hüpoteesist on mudeli eeldused ja ennustused läbinähtavad ja täpselt formuleeritavad. Mudeli puuduseks on aga, et erinevalt teooriast ei ole mingit võimalust, et mudel vastaks tegelikkusele. Seda sellepärast, et mudel on taotluslikult lihtsustav (erandiks on puhtalt ennustuslikud mudelid, mis on aga enamasti läbinähtamatu struktuuriga). Mudel on kas kasulik või kasutu; teooria on kas tõene või väär. Mudeli ja maailma vahel võib olla kaudne peegeldus, aga mitte kunagi otsene side. Seega, ükski number, mis arvutatakse mudeli raames, ei kandu sama numbrina üle teaduslikku ega päris maailma. Ja kogu statistika (ka mitteparameetriline) toimub mudeli väikses maailmas. Arvud, mida statistika teile pakub, elavad mudeli maailmas; samas kui teie teaduslik huvi on suunatud päris maailmale. Näiteks 95% usaldusintervall ei tähenda, et te peaksite olema 95% kindel, et tõde asub selles intervallis – sageli ei tohiks te seda nii julgelt tõlgendada isegi kitsas mudeli maailmas.</p>
<div id="naide-aristoteles-ptolemaios-ja-kopernikus" class="section level3">
<h3><span class="header-section-number">8.7.1</span> Näide: Aristoteles, Ptolemaios ja Kopernikus</h3>
<p>Aristoteles (384–322 BC) lõi teooria maailma toimimise kohta, mis domineeris haritud eurooplase maailmapilti enam kui 1200 aasta vältel. Tema ühendteooria põhines maailmapildil, mis oli üldtunnustatud juba sajandeid enne Aristotelest ja järgneva 1500 aasta jooksul kahtlesid selles vähesed mõistlikud inimesed. Selle kohaselt asub universumi keskpunktis statsionaarne maakera ning kõik, mida siin leida võib, on tehtud neljast elemendist: maa, vesi, õhk ja tuli. Samas, kogu maailmaruum alates kuu sfäärist on tehtud viiendast elemendist (eeter), mida aga ei leidu maal (nagu nelja elementi ei leidu kuu peal ja sealt edasi). Taevakehad (kuu, päike, planeedid ja kinnistähed) tiirlevad ümber maa kontsentrilistes sfäärides, mille vahel pole vaba ruumi. Seega on kogu liikumine eetri sfäärides ühtlane ja ringikujuline ja see liikumine põhjustab pika põhjus-tagajärg ahela kaudu kõiki liikumisi, mida maapeal kohtame. Kaasa arvatud sündimine, elukäik ja surm. Kõik, mis maapeal huvitavat, ehk kogu liikumine, on algselt põhjustatud esimese liikumise poolt, mille käivitab kõige välimises sfääris paiknev meie jaoks mõistetamatu intellektiga “olend”.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-235"></span>
<img src="img/arist.jpg" alt="Keskaegne aristotellik maailm." width="600" />
<p class="caption">
Joonis 8.1: Keskaegne aristotellik maailm.
</p>
</div>
<p>Aristotelese suur teooria ühendab kogu maailmapildi alates meie mõistes keemiast ja kosmoloogiast kuni bioloogia, maateaduse ja isegi geograafiani. Sellist ühendteooriat on erakordselt raske ümber lükata, sest seal on kõik kõigega seotud.</p>
<blockquote>
<p>Aristarchus (c. 310 – c. 230 BC) proovis seda siiski, väites, et tegelikult tiirleb maakera ümber statsionaarse päikese. Ta uskus ka, et kinnistähed on teised päikesed, et universum on palju suurem kui arvati (ehkki kaasaegne seisukoht oli, et universumi mastaabis ei ole maakera suurem kui liivatera) ning, et maakera pöörleb ümber oma telje. Paraku ei suutnud Aristarchuse geotsentriline teooria toetajaid leida, kuna see ei pidanud vastu vaatluslikule testile. Geotsentrilisest teooriast tuleneb nimelt loogilise paratametusena, et tähtedel esineb maalt vaadates parallaks. See tähendab, et kui maakera koos astronoomiga teeb poolringi ümber päikese, siis kinnistähe näiv asukoht taevavõlvil muutub, sest astronoom vaatleb teda teise nurga alt. Pange oma nimetissõrm näost u 10 cm kaugusele, sulgege parem silm, seejärel avage see ning sulgege vasak silm ja te näete oma sõrme parallaksi selle näiva asukoha muutusena. Mõõtmised ei näidanud aga parallaksi olemasolu (sest maa trajektoori diameeter on palju lühem maa kaugusest tähtedest). Parallaksi suudeti esmest korda mõõta alles 1838, siis kui juba iga koolijüts uskus, et maakera tiirleb ümber päikese!</p>
</blockquote>
<p>Ühte Aristotelese kosmoloogia olulist puudust nähti siiski kohe. Nimelt ei suuda Aristoteles seletada, miks osad planeedid teavavõlvil vahest suunda muudavad ja mõnda aega lausa vastupidises suunas liiguvad (retrogressioon). Kuna astronoomiat kasutasid põhiliselt astroloogid, siis põõrati planeetide liikumisele suurt tähelepanu. Lahenduseks ei olnud aga mitte suure teooria ümbertegemine või ümberlükkamine, vaid uue teaduse nõudmine, mis “päästaks fenomenid”. Siin tuli appi Ptolemaios (c. AD 100 – c. 170), kes lõi matemaatilise mudeli, kus planeedid mitte lihtsalt ei liigu ringtrajektoori mõõda, vaid samal ajal teevad ka väiksemaid ringe ümber esimese suure ringjoone. Neid väiksemaid ringe kutsutakse epitsükliteks. See mudel suutis planeetide liikumist taevavõlvil piisavalt hästi ennustada, et astroloogide seltskond sellega rahule jäi.</p>
<p>Ptolemaiosel ja tema järgijatel oli tegelikult mitu erinevat mudelit. Osad neist ei sisaldanud epitsükleid ja maakera ei asunud tema mudelites universumi keskel, vaid oli sellest punktist eemale nihutatud — nii et päike ei teinud ringe ümber maakera vaid ümber tühja punkti. Kuna leidus epitsüklitega mudel ja ilma epitsükliteta mudel, mis andsid identseid ennustusi, on selge, et Aristotelese teooria ja fenomenide päästmise mudelid on põhimõtteliselt erinevad asjad. Samal ajal, kui Aritoteles <strong>seletas</strong> maailma põhiolemust põhjuslike seoste jadana (mitte matemaatiliselt), <strong>kirjeldas/ennustas</strong> Ptolemaios sellesama maailma käitumist matemaatiliste (mitte põhjuslike) struktuuride abil.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-236"></span>
<img src="img/pt2.jpg" alt="Ilma epitsükliteta ptolemailine mudel." width="600" />
<p class="caption">
Joonis 8.2: Ilma epitsükliteta ptolemailine mudel.
</p>
</div>
<p>Nii tekkis olukord, kus maailma mõistmiseks kasutati Aristotelese ühendteooriat, aga selle kirjeldamiseks ja tuleviku ennustamiseks hoopis ptolemailisi mudeleid, mida keegi päriselt tõeks ei pidanud ja mida hinnati selle järgi, kui hästi need “päästsid fenomene”.</p>
<p>See toob meid Kopernikuse (1473 – 1543) juurde, kes teadusajaloolaste arvates vallandas 17. sajandi teadusliku revolutsiooni, avaldades raamatu, kus ta asetab päikese universumi keskele ja paneb maa selle ümber ringtrajektooril tiirlema. Kas Kopernikus tõrjus sellega kõrvale Aristotelese, Ptolemaiose või mõlemad? Tubdub, et Kopernikus soovis kolmandat, suutis esimest, ning et tolleaegsete lugejate arvates üritas ta teha teist — ehk välja pakkuda alternatiivi ptolemailistele mudelitele, mis selleks ajaks olid muutunud väga keerukaks (aga ka samavõrra ennustustäpseks). Kuna Kopernikuse raamat läks trükki ajal, mil selle autor oli juba oma surivoodil, kirjutas sellele eessõna üks tema vaimulikust sõber, kes püüdis oodatavat kiriklikku pahameelt leevendada vihjates, et päikese keskele viimine on vaid mudeldamise trikk, millest ei tasu järeldada, et maakera ka tegelikult ümber päikese tiirleb (piibel räägib, kuidas jumal peatas taevavõlvil päikese, mitte maa). Ja kuna eessõna oli anonüümne, eeldasid lugejad muidugi, et selle kirjutas autor. Lisaks, kuigi Kopernikus tõstis päikese keskele, jäi ta planeetide ringikujuliste trajektooride juurde, mis tähendas, et selleks, et tema teooria fenomenide päästmisel hätta ei jääks, oli ta sunnitud maad ja planeete liigutama ümber päikese mõõda epitsükleid. Kokkuvõttes oli Kopernikuse mudel pea-aegu sama keeruline kui Ptolemaiose standardmudel ja selle abil tehtud ennustused planeetide liikumise kohta olid väiksema täpsusega. Seega, ennustava mudelina ei olnud tal suuri eeliseid ptolemailike mudelite ees.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-237"></span>
<img src="img/kop.jpg" alt="Ptolemaiose ja Kopernikuse mudelid on üllatavalt sarnased." width="600" />
<p class="caption">
Joonis 8.3: Ptolemaiose ja Kopernikuse mudelid on üllatavalt sarnased.
</p>
</div>
<blockquote>
<p>Kopernikuse mudel suutis siiski ennustada mõningaid nähtusi (planeetide näiv heledus jõuab maksimumi nende lähimas asukohas maale), mida Ptolemaiose mudel ei ennustanud. See ei tähenda, et need fenomenid oleksid olnud vastuolus Ptolemaiose mudeliga. Lihtsalt, nende Ptolemaiose mudelisse sobitamiseks oli vaja osad mudeli parameetrid fikseerida nii-öelda suvalistele väärtustele. Seega Koperniku mudel töötas nii, nagu see oli, samas kui Ptolemaiose mudel vajas ad hoc tuunimimst.</p>
</blockquote>
<p>Kui vaadata Koperniku produkti teooriana, mitte mudelina, siis oli sellel küll selgeid eeliseid Aristotelese maailmateooria ees. Juba ammu oli nähtud komeete üle taevavõlvi lendamas (mis Aristotelese järgi asusid kinnistähtede muutumatus sfääris), nagu ka supernoova tekkimist ja kadu, ning enam ei olnud kaugel aeg, mil Galileo joonistas oma teleskoobist kraatreid kuu pinnal, näidates, et kuu ei saanud koosneda täiuslikust viiendast elemendist ja et sellel toimusid ilmselt sarnased füüsikalised protsessid kui maal. On usutav, et kui Kopernikus oleks jõudnud oma raamatule ise essõna kirjutada, oleks tema teooria vastuvõtt olnud palju kiirem (ja valulisem).</p>
</div>
</div>
<div id="lineaarsed-mudelid" class="section level2">
<h2><span class="header-section-number">8.8</span> Lineaarsed mudelid</h2>
<p>Oletame, et me mõõtsime N inimese pikkuse cm-s ja kaalu kg-s ning meid huvitab, kuidas inimeste pikkus sõltub nende kaalust. Lihtsaim mudel pikkuse sõltuvusest kaalust on pikkus = kaal (formaliseeritult: y = x) ja see mudel ennustab, et kui Johni kaal = 80 kg, siis John on 80 cm pikkune. siin on pikkus muutuja, mille väärtust ennustatakse ja kaal muutuja, mille väärtuste põhjal ennustatakse pikkusi. Selle mudeli saame graafiliselt kujutada nii:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">100</span> <span class="co">#y = kaal</span>
y &lt;-<span class="st"> </span>x <span class="co"># x = pikkus </span>
<span class="kw">plot</span>(y<span class="op">~</span>x, 
     <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, 
     <span class="dt">xlab=</span><span class="st">&quot;weight in kg&quot;</span>, 
     <span class="dt">ylab=</span><span class="st">&quot;heigth in cm&quot;</span>)</code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-238-1.svg" width="288" /></p>
<p>Mudeli keeles tähistame me seda, mida me ennustame (antud juhul pikkus) Y-ga ja seda, mille väärtuse põhjal me ennustame (antud juhul kaal) X-ga. Seega sirge mudeli matemaatiline formalism on Y = X.</p>
<p>See on äärmiselt jäik mudel: sirge, mille asukoht on rangelt fikseeritud. Sirge lõikab y telge alati 0-s (mudeli keeles: sirge intercept ehk lõikepunkt Y teljel = 0) ja tema tõusunurk saab olla ainult 45 kraadi (mudeli keeles: mudeli slope ehk tõus = 1). Selle mudeli jäikus tuleneb sellest, et temas ei ole parameetreid, mille väärtusi me saaksime vabalt muuta ehk tuunida.</p>
<p>Mis juhtub, kui me lisame mudelisse konstandi, mille liidame x-i väärtustele?</p>
<p><em>y = a + x</em></p>
<p>See konstant on mudeli parameeter, mille väärtuse võime vabalt valida. Järgnevalt anname talle väärtuse 30 (ilma konkreetse põhjuseta).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">100</span> 
a &lt;-<span class="st"> </span><span class="dv">30</span>
y &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>x 
<span class="kw">plot</span>(y<span class="op">~</span>x, 
     <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), 
     <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">150</span>), 
     <span class="dt">col=</span><span class="st">&quot;red&quot;</span>,
     <span class="dt">type=</span><span class="st">&quot;l&quot;</span>)
<span class="kw">abline</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">lty=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-239-1.svg" width="288" /></p>
<p>Meie konstant a määrab <em>y</em> väärtuse, kui <em>x = 0</em>, ehk sirge lõikepunkti <em>y</em> teljel. Teisisõnu, a = mudeli intercept</p>
<p>Mis juhtub, kui me mitte ei liida, vaid korrutame <em>x</em>-i konstandiga?</p>
<p><em>y = bx</em></p>
<p>Jällegi, me anname mudeli parameetrile b suvalise väärtuse, 3.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">200</span> <span class="co">#y = kaal</span>
b &lt;-<span class="st"> </span><span class="dv">3</span>
y &lt;-<span class="st"> </span>b<span class="op">*</span>x <span class="co"># x = pikkus </span>
<span class="kw">plot</span>(y<span class="op">~</span>x, 
     <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), 
     <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), 
     <span class="dt">col=</span><span class="st">&quot;red&quot;</span>,
     <span class="dt">type=</span><span class="st">&quot;l&quot;</span>)
<span class="kw">abline</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">lty=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-240-1.svg" width="288" /></p>
<p>Nüüd muutub sirge tõusunurk, ehk kui palju me ootame <em>y</em>-t muutumas, kui <em>x</em> muutub näiteks ühe ühiku võrra. Kui b = 3, siis <em>x</em>-i tõustes ühe ühiku võrra suureneb <em>y</em> kolme ühiku võrra. Proovi järgi, mis juhtub, kui b = -3.</p>
<p>Selleks, et sirget kahes dimensioonis vabalt liigutada, piisab kui me kombineerime eelnevad näited ühte:</p>
<p><em>y = a + bx</em></p>
<p>Selleks lisame mudelisse kaks parameetrit, intercept (a) ja tõus (b). Kui <em>a = 0</em> ja <em>b = 1</em>, saame me eelpool kirjeldatud mudeli <em>y = x</em>. Kui <em>a = 102</em>, siis sirge lõikab <em>y</em> telge väärtusel 102. Kui <em>b = 0.8</em>, siis <em>x</em>-i tõustes 1 ühiku võrra tõuseb <em>y</em>-i väärtus 0.8 ühiku võrra. Kui <em>a = 100</em> ja <em>b = 0</em>, siis saame sirge, mis on paraleelne x-teljega ja lõikab y-telge väärtusel 100. Seega, Teades a ja b väärtusi ning omistades x-le suvalise meid huvitava väärtuse, saab ennustada y-i keskmist väärtust sellel x-i väärtusel. Näiteks, olgu andmete vastu fititud mudel:</p>
<p>pikkus(cm) = 102 + 0.8 * kaal(kg) ehk</p>
<p><em>y = 102 + 0.8x</em>.</p>
<p>Omistades nüüd kaalule väärtuse 80 kg, tuleb mudeli poolt ennustatud keskmine pikkus 102 + 0.8 * 80 = 166 cm. Iga kg lisakaalu ennustab mudeli kohaselt 0.8 cm võrra suuremat pikkust.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="dv">102</span>
b &lt;-<span class="st"> </span><span class="fl">0.8</span>
x &lt;-<span class="st">  </span><span class="dv">0</span><span class="op">:</span><span class="dv">100</span> 
y &lt;-<span class="st">  </span>a <span class="op">+</span><span class="st"> </span>b <span class="op">*</span><span class="st"> </span>x
<span class="kw">plot</span>(y<span class="op">~</span>x, 
     <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, 
     <span class="dt">xlab=</span><span class="st">&quot;weight in kg&quot;</span>, 
     <span class="dt">ylab=</span><span class="st">&quot;heigth in cm&quot;</span>, 
     <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">200</span>))</code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-241-1.svg" width="288" /></p>
<p>See mudel ennustab, et 0 kaalu juures on pikku 102 cm, mis on rumal, aga mudelite puhul tavaline, olukord. Me tuunime mudelit andmete peal, mis ei sisalda 0-kaalu. Meie valimiandmed ei peegelda täpselt inimpopulatsiooni. Sirge mudel ei peegelda täpselt pikkuse-kaalu suhteid vahemikus, kus meil on reaalseid kaaluandmeid; ja ta teeb seda veelgi vähem seal, kus meil mõõdetud kaalusid ei ole. Seega pole mõtet imestada, miks mudeli intercept meie üle irvitab.</p>
<p>Kahe parameetriga sirge mudel ongi see, mida me fitime kahedimensiooniliste andmetega. Näiteks nii:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#read in the internal dataset iris</span>
<span class="kw">data</span>(iris)
<span class="co"># fit a linear model and name the model object as m1</span>
m1 &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="dt">data=</span>iris, Sepal.Length <span class="op">~</span><span class="st"> </span>Petal.Length)
<span class="co"># make a scatter plot, colored by the var called &quot;Species&quot;</span>
<span class="kw">plot</span>(iris<span class="op">$</span>Sepal.Length<span class="op">~</span>iris<span class="op">$</span>Petal.Length, <span class="dt">col=</span>iris<span class="op">$</span>Species)
<span class="co"># draw the fitted regression line from m1</span>
<span class="kw">abline</span>(m1)</code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-242-1.svg" width="672" /></p>
<p>Mudeli fittimine tähendab siin lihtsalt, et sirge on 2D ruumi asetatud nii, et see oleks võimalikult lähedal kõikidele punktidele.</p>
<blockquote>
<p>oletame, et meil on n andmepunkti ja et me fitime neile sirge. Nüüd plotime fititud sirge koos punktidega ja tõmbame igast punktist mudelsirgeni joone, mis on paraleelne y-teljega. Seejärel mõõdame nende n joone pikkused. Olgu need pikkused a, b, … i. lm() funktsioon fitib sirge niimoodi, et summa a<sup>2</sup> + b<sup>2</sup> + … i<sup>2</sup> oleks minimaalne. Seda kutsutakse vähimruutude meetodiks.</p>
</blockquote>
<p>Fititud koefitsientide väärtused saame nii</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(m1)</code></pre></div>
<pre><code>##  (Intercept) Petal.Length 
##       4.3066       0.4089</code></pre>
<p>Siin a = (Intercept) ja b = Petal.Length ehk 0.41.</p>
<p><strong>ennustus lineaarsest mudelist</strong></p>
<p>Anname x-le rea väärtusi, et ennustada y keskmisi väärtusi nendel x-i väärtustel. Siin me ennustame y (Sepal_length) keskväärtusi erinevatel x-i (Petal_length) väärtustel, mitte individuaalseid Sepal_length väärtusi. Me kasutame selleks deterministlikku mudelit kujul Sepal_length = a + b*Petal_length. Hiljem õpime ka bayesiaanlike meetoditega individuaalseid Sepal_length-e ennustama.</p>
<p>Järgnev kood on sisuliselt sama, millega me üle-eelmisel plotil joonistasime mudeli y = a + bx. Me fikseerime mudeli koefitsiendid fititud irise mudeli omadega ja anname Petal_length muutujale 10 erinevat väärtust originaalse muutuja mõõtmisvahemikus. Aga sama hästi võiksime ekstrapoleerida ja küsida, mis on oodatav Sepal_length, kui Petal_length on 100 cm? Loll küsimus, aga mudel ei tea seda. Proovi seda kodus.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Petal_length &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(iris<span class="op">$</span>Petal.Length), 
                    <span class="kw">max</span>(iris<span class="op">$</span>Petal.Length), 
                    <span class="dt">length.out =</span> <span class="dv">10</span>)
a &lt;-<span class="st"> </span><span class="kw">coef</span>(m1)[<span class="dv">1</span>]
b &lt;-<span class="st"> </span><span class="kw">coef</span>(m1)[<span class="dv">2</span>]

Sepal_length &lt;-<span class="st">  </span>a <span class="op">+</span><span class="st"> </span>b<span class="op">*</span>Petal_length

<span class="kw">plot</span>(Sepal_length<span class="op">~</span>Petal_length, <span class="dt">type=</span><span class="st">&quot;b&quot;</span>)</code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-244-1.svg" width="672" /></p>
<p>Siin ennustasime 10 y väärtust 10-l x-i väärtusel.</p>
<div id="neli-moistet" class="section level3">
<h3><span class="header-section-number">8.8.1</span> Neli mõistet</h3>
<p>Mudelis <em>y = a + bx</em> on <em>x</em> ja <em>y</em> muutujad, ning <em>a</em> ja <em>b</em> on parameetrid. Muutujate väärtused fikseeritakse andmete poolt, parameetrid fititakse andmete põhjal. Fititud mudel ennustab igale <em>x</em>-i väärtusele vastava kõige tõenäolisema <em>y</em> väärtuse (<em>y</em> keskväärtuse sellel <em>x</em>-i väärtusel).</p>
<blockquote>
<p>Y - mida me ennustame (dependent variable, predicted variable)</p>
</blockquote>
<blockquote>
<p>X - mille põhjal me ennustame (independent variable, predictor)</p>
</blockquote>
<blockquote>
<p>muutuja (variable) - iga asi, mida me valimis mõõdame (X ja Y on kaks muutujat). Muutujal on sama palju fikseeritud väärtusi kui meil on selle muutuja kohta mõõtmisandmeid.</p>
</blockquote>
<blockquote>
<p>parameeter (parameter) - mudeli koefitsient, millele võib omistada suvalisi väärtusi. Parameetreid tuunides fitime mudeli võimalikult hästi sobituma andmetega.</p>
</blockquote>
<p>Mudel on matemaatilise formalism, mis püüab kirjeldada füüsikalist protsessi. Statistilise mudeli struktuuris on komponent, mis kirjeldab ideaalseid ennustusi (nn protsessi mudel) ja eraldi veakomponent (ehk veamudel), mis kirjeldab looduse varieeruvust nende ideaalsete ennustuste ümber. Mudeli koostisosad on (i) muutuja, mille väärtusi ennustatakse, (ii), muutuja(d), mille väärtuste põhjal ennustatakse, (iii) parameetrid, mille väärtused fititakse ii põhjal ja (iv) konstandid.</p>
</div>
<div id="mudeli-fittimine" class="section level3">
<h3><span class="header-section-number">8.8.2</span> Mudeli fittimine</h3>
<p>Mudelid sisaldavad (1) matemaatilisi struktuure, mis määravad mudeli tüübi ning (2) parameetreid, mida saab andmete põhjal tuunida, niiviisi täpsustades mudeli kuju.</p>
<p>Seda tuunimist nimetatakse mudeli fittimiseks. Mudelit fittides on eesmärk saavutada antud tüüpi mudeli maksimaalne sobivus andmetega. Näiteks võrrand <em>y = a + bx</em> määrab mudeli, kus <em>y = x</em> on on see struktuur, mis tagab, et mudeli tüüp on sirge, ning <em>a</em> ja <em>b</em> on parameetrid, mis määravad sirge asendi. Seevastu struktuur <em>y = x + x<sup>2</sup></em> tagab, et mudeli <em>y = a + b<sub>1</sub>x + b<sub>2</sub>x<sup>2</sup></em> tüüp on parabool, ning parameetrite <em>a</em>, <em>b<sub>1</sub></em> ja <em>b~2</em> väärtused määravad selle parabooli täpse kuju. Ja nii edasi.</p>
<blockquote>
<p>lineraarse mudeli parima sobivuse andmetega saab tagada kahel erineval viisil: (i) vähimruutude meetod mõõdab y telje suunaliselt iga andmepunkti kauguse mudeli ennustusest, võtab selle kauguse ruutu, summeerib kauguste ruudud ning leiab sirge asendi, mille korral see summa on minimaalne; (ii) Bayesi teoreem annab väheinformatiivse priori korral praktiliselt sama fiti.</p>
</blockquote>
<p>Hea mudel on</p>
<ol style="list-style-type: decimal">
<li><p>võimalikult lihtsa struktuuriga, mille põhjal on veel võimalik teha järeldusi protsessi kohta, mis genereeris mudeli fittimiseks kasutatud andmeid;</p></li>
<li><p>sobitub piisavalt hästi andmetega (eriti uute andmetega, mida ei kasutatud selle mudeli fittimiseks), et olla relevantne andmeid genereeriva protsessi kirjeldus;</p></li>
<li><p>genereerib usutavaid simuleeritud andmeid.</p></li>
</ol>
<p>Sageli fititkse samade andmetega mitu erinevat tüüpi mudelit ja püütakse otsustada, milline neist vastab kõige paremini eeltoodud tingimustele. Näiteks, kui sirge suudab kaalu järgi pikkust ennustada paremini kui parabool, siis on sirge mudel paremas kooskõlas teadusliku hüpoteesiga, mis annaks mehhanismi protsessile, mille käigus kilode lisandumine viiks laias kaaluvahemikus inimeste pikkuse kasvule ilma, et pikkuse kasvu tempo kaalu tõustes langeks.</p>
<p>See, et teie andmed sobivad hästi mingi mudeliga, ei tähenda automaatselt, et see fakt oleks teaduslikult huvitav. Mudeli parameetrid on mõtekad mudeli matemaatilise kirjelduse kontekstis, aga mitte tingimata suure maailma põhjusliku seletamise kontekstis. Siiski, kui mudeli matemaatiline struktuur loodi andmeid genreeeriva loodusliku protsessi olemust silmas pidades, võib mudeli koefitsientide uurimisest selguda olulisi tõsiasju suure maailma kohta.</p>
<blockquote>
<p>Mudeli fittimine: X ja Y saavad oma väärtused otse andmetest; parameetrid võivad omandada ükskõik millise väärtuse.</p>
</blockquote>
<blockquote>
<p>Fititud mudelist ennustamine: X-le saab omistada ükskõik millise väärtuse; parameetrite väärtused on fikseeritud; Y väärtus arvutatakse mudelist.</p>
</blockquote>
<div id="ule--ja-alafittimine" class="section level4">
<h4><span class="header-section-number">8.8.2.1</span> Üle- ja alafittimine</h4>
<p>Osad mudelite tüübid on vähem paindlikud kui teised (parameetreid tuunides on neil vähem liikumisruumi). Kuigi sellised mudelid sobituvad halvemini andmetega, võivad need ikkagi paremini kui mõni paindlikum mudel välja tuua andmete peidetud olemuse. Mudeldamine eeldab, et me usume, et meie andmetes leidub nii müra (mida mudel võiks ignoreerida), kui signaal (mida mudel püüab tabada). Kuna mudeli jaoks näeb müra samamoodi välja, kui signaal, on iga mudel kompromiss üle- ja alafittimise vahel. Me lihtsalt loodame, et meie mudel on piisavalt jäik, et mitte liiga palju müra modelleerida ja samas piisavalt paindlik, et piisaval määral signaali tabada.</p>
<p>Üks kõige jäigemaid mudeleid on sirge, mis tähendab, et sirge mudel on suure tõenäosusega alafittitud. Keera sirget kuipalju tahad, ikka ei sobitu ta enamiku andmekogudega. Ja need vähesed andmekogud, mis sirge mudeliga sobivad, on genereeritud teatud tüüpi lineaarsete protsesside poolt. Sirge on seega üks kõige paremini tõlgendatavaid mudeleid. Teises äärmuses on polünoomsed mudelid, mis on väga paindlikud, mida on väga raske tõlgendada ja mille puhul esineb suur mudeli ülefittimise oht. Ülefititud mudel järgib nii täpselt valimiandmeid, et sobitub hästi valimis leiduva juhusliku müraga ning seetõttu sobitub halvasti järgmise valimiga samast populatsioonist (igal valimil on oma juhuslik müra). Üldiselt, mida rohkem on mudelis tuunitavaid parameetreid, seda paindlikum on mudel, seda kergem on seda valimiandmetega sobitada ja seda raskem on seda tõlgendada. Veelgi enam, alati on võimalik konstrueerida mudel, mis sobitub täiuslikult kõikide andmepunktidega (selle mudeli parameetrite arv = N). Selline mudel on täpselt sama informatiivne kui andmed, mille põhjal see fititi — ja täiesti kasutu.</p>
<p><img src="main_files/figure-html/unnamed-chunk-245-1.svg" width="576" /> <em>Joonis: Kasvava paindlikusega polünoomsed mudelid. mod_e1 on sirge võrrand y = a + b<sub>1</sub>x (2 parameetrit: a ja b<sub>1</sub>), mod_e2 on lihtsaim võimalik polünoom: y= a + b<sub>1</sub>x + b<sub>2</sub>x^2 (3 parameetrit), …, mod_e5: y= a + b<sub>1</sub>x + b<sub>2</sub>x^2 + b<sub>3</sub>x^3 + b4x^4 + b5x^5 (6 parameetrit). mod_e5 vastab täpselt andmepunktidele (N = 6).</em></p>
<p>Vähimruutude meetodil fititud mudeleid saame võrrelda AIC-i näitaja järgi. AIC - Akaike Informatsiooni Kriteerium - vaatab mudeli sobivust andmetega ja mudeli parameetrite arvu. Väikseim AIC tähitab parimat fitti väikseima parameetrite arvu juures (kompromissi) ja väikseima AIC-ga mudel on eelistatuim mudel. Aga seda ainult võrreldud mudelite hulgas. AIC-i absoluutväärtus ei loe - see on suhteline näitaja.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">AIC</span>(mod_e1, mod_e2, mod_e3, mod_e4, mod_e5)</code></pre></div>
<pre><code>##        df   AIC
## mod_e1  3 27.78
## mod_e2  4 29.77
## mod_e3  5 26.21
## mod_e4  6 25.11
## mod_e5  7  -Inf</code></pre>
<p>AIC näitab, et parim mudel on mod_e4. Aga kas see on ka kõige kasulikum mudel? Mis siis, kui 3-s andmepunkt on andmesisestaja näpuviga?</p>
<pre><code>Ülefittimise vältimiseks kasutavad Bayesi mudelid informatiivseid prioreid, 
mis välistavad ekstreemsed parameetriväärtused. 
Vt http://elevanth.org/blog/2017/08/22/there-is-always-prior-information/ </code></pre>
</div>
</div>
<div id="kaks-lineaarse-mudeli-laiendust." class="section level3">
<h3><span class="header-section-number">8.8.3</span> kaks lineaarse mudeli laiendust.</h3>
<div id="mitme-soltumatu-prediktoriga-mudel" class="section level4">
<h4><span class="header-section-number">8.8.3.1</span> mitme sõltumatu prediktoriga mudel</h4>
<p>Esiteks vaatame mudelit, kus on mitu prediktorit x<sub>1</sub>, x<sub>2</sub>, … xn, mis on additiivse mõjuga. See tähendab, et me liidame nende mõjud, mis omakorda tähendab, et me usume, et x<sub>1</sub>…xn mõjud y-i väärtusele on üksteisest sõltumatud. Mudel on siis kujul</p>
<p><em>y = a + b<sub>1</sub>x<sub>1</sub> + b<sub>2</sub>x<sub>2</sub> + … + bnxn</em></p>
<blockquote>
<p>mitme prediktoriga mudeli iga prediktori tõus (beta koefitsient) ütleb, mitme ühiku võrra ennustab mudel y muutumist juhul kui see prediktor muutub ühe ühiku võrra ja kõik teised prediktorid ei muutu üldse. Seega pole teiste (kollapseeritud) prediktorite absoluutväärtus ennustusel oluline.</p>
</blockquote>
<p>Kui meie andmed on mõõdetud 3D-s ja me tahame ennnustada ühe muutuja väärtust kahe teise muutuja väärtuste põhjal (meil on 2 prediktorit), siis tuleb meie 3 parameetriga lineaarne regressioonimudel tasapinna kujul. Kui meil on 4 prediktoriga mudel, siis me liigume 4-mõõtmelisse ruumi, jne. 3D ruumi on veel võimalik mõistlikult plottida.</p>
<p><img src="main_files/figure-html/unnamed-chunk-247-1.svg" width="672" /></p>
<p>Seda mudelit saab kaeda 2D ruumis, kui kollapseerida kolmas mõõde konstandile.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(iris)
m1 &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="dt">data=</span>iris, Sepal.Width<span class="op">~</span>Sepal.Length <span class="op">+</span><span class="st"> </span>Petal.Length)
<span class="kw">plot</span>(iris<span class="op">$</span>Sepal.Width<span class="op">~</span>iris<span class="op">$</span>Sepal.Length, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">8</span>), <span class="dt">col=</span>iris<span class="op">$</span>Species)
<span class="kw">abline</span>(m1)</code></pre></div>
<pre><code>## Warning in abline(m1): only using the first two of 3
## regression coefficients</code></pre>
<p><img src="main_files/figure-html/unnamed-chunk-248-1.svg" width="672" /></p>
<p>Enam ei läbi sirge punkte, nagu ta seda 3D ruumis tegi.</p>
<p>Võrlduseks ühe prediktoriga mudel</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="dt">data=</span>iris, Sepal.Width<span class="op">~</span>Sepal.Length)
<span class="kw">plot</span>(iris<span class="op">$</span>Sepal.Width<span class="op">~</span>iris<span class="op">$</span>Sepal.Length, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">8</span>), <span class="dt">col=</span>iris<span class="op">$</span>Species)
<span class="kw">abline</span>(m)</code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-249-1.svg" width="672" /></p>
<p>Nõnda võrdleme kahe mudeli koefitsiente</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(m); <span class="kw">coef</span>(m1)</code></pre></div>
<pre><code>##  (Intercept) Sepal.Length 
##      3.41895     -0.06188</code></pre>
<pre><code>##  (Intercept) Sepal.Length Petal.Length 
##       1.0381       0.5612      -0.3353</code></pre>
<p>Nagu näha, mudeli m b<sub>1</sub> koefitsient erineb oluliselt mudeli m1 vastavast koefitsiendist.</p>
<p>Kumb mudel on siis parem? AIC-i järgi on m1 kõvasti parem, kui m.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">AIC</span>(m, m1)</code></pre></div>
<pre><code>##    df    AIC
## m   3 179.46
## m1  4  92.12</code></pre>
<p><strong>Ennustused sõltumatute prediktoritega mudelist</strong></p>
<p>Siin on idee kasutada fititud mudeli struktuuri enustamaks y keskmisi väärtusi erinevatel x<sub>1</sub> ja x<sub>2</sub> väärtustel. Kuna mudel on fititud, on parameetrite väärtused fikseeritud.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Sepal_length &lt;-<span class="st">  </span><span class="kw">seq</span>(<span class="kw">min</span>(iris<span class="op">$</span>Sepal.Length), 
                     <span class="kw">max</span>(iris<span class="op">$</span>Sepal.Length), 
                     <span class="dt">length.out =</span> <span class="dv">10</span>) 
Petal_length &lt;-<span class="st">  </span><span class="kw">mean</span>(iris<span class="op">$</span>Petal.Length)
a &lt;-<span class="st"> </span><span class="kw">coef</span>(m1)[<span class="dv">1</span>]
b1 &lt;-<span class="st"> </span><span class="kw">coef</span>(m1)[<span class="dv">2</span>]
b2 &lt;-<span class="st"> </span><span class="kw">coef</span>(m1)[<span class="dv">3</span>]
Sepal_width &lt;-<span class="st">   </span>a <span class="op">+</span><span class="st"> </span>b1<span class="op">*</span>Sepal_length <span class="op">+</span><span class="st"> </span>b2<span class="op">*</span>Petal_length
<span class="kw">plot</span>(Sepal_width<span class="op">~</span>Sepal_length, 
     <span class="dt">type=</span><span class="st">&quot;b&quot;</span>, 
     <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>), 
     <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)
<span class="kw">abline</span>(<span class="kw">c</span>(<span class="kw">coef</span>(m)[<span class="dv">1</span>], <span class="kw">coef</span>(m)[<span class="dv">2</span>]), <span class="dt">lty=</span><span class="dv">2</span>) <span class="co">#prediction from the single predictor model</span></code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-252-1.svg" width="288" /></p>
<p>Nüüd joonistame 3D pildi olukorrast, kus nii <em>x<sub>1</sub></em> kui <em>x<sub>2</sub></em> omandavad rea väärtusi. Mudeli ennustus on ikkagi sirge kujul – mis sest, et 3D ruumis.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#library(rgl) #plot3d()</span>
<span class="kw">library</span>(scatterplot3d)
Sepal_length &lt;-<span class="st">  </span><span class="kw">seq</span>(<span class="kw">min</span>(iris<span class="op">$</span>Sepal.Length), 
                     <span class="kw">max</span>(iris<span class="op">$</span>Sepal.Length), 
                     <span class="dt">length.out =</span> <span class="dv">10</span>) 
Petal_length &lt;-<span class="st">  </span><span class="kw">seq</span>(<span class="kw">min</span>(iris<span class="op">$</span>Petal.Length), 
                     <span class="kw">max</span>(iris<span class="op">$</span>Petal.Length), 
                     <span class="dt">length.out =</span> <span class="dv">10</span>) 
a &lt;-<span class="st"> </span><span class="kw">coef</span>(m1)[<span class="dv">1</span>]
b1 &lt;-<span class="st"> </span><span class="kw">coef</span>(m1)[<span class="dv">2</span>]
b2 &lt;-<span class="st"> </span><span class="kw">coef</span>(m1)[<span class="dv">3</span>]
Sepal_width &lt;-<span class="st">   </span>a <span class="op">+</span><span class="st"> </span>b1<span class="op">*</span>Sepal_length <span class="op">+</span><span class="st"> </span>b2<span class="op">*</span>Petal_length
df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Sepal_width=</span>Sepal_width, 
                 <span class="dt">Sepal_length=</span>Sepal_length, 
                 <span class="dt">Petal_length=</span>Petal_length)
<span class="kw">scatterplot3d</span>(df<span class="op">$</span>Sepal_length, 
              df<span class="op">$</span>Petal_length, 
              df<span class="op">$</span>Sepal_width, 
              <span class="dt">col.axis=</span><span class="st">&quot;blue&quot;</span>, 
              <span class="dt">col.grid=</span><span class="st">&quot;lightblue&quot;</span>, 
              <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-253-1.svg" width="672" /></p>
</div>
<div id="interaktsioonimudel---uhe-prediktori-moju-soltub-teise-prediktori-vaartusest" class="section level4">
<h4><span class="header-section-number">8.8.3.2</span> Interaktsioonimudel - ühe prediktori mõju sõltub teise prediktori väärtusest</h4>
<p><em>y = a + b<sub>1</sub>x<sub>1</sub> + b<sub>2</sub>x<sub>2</sub> + b<sub>3</sub>x<sub>1</sub>x<sub>2</sub></em></p>
<p>Interaktsioonimudeli koefitsientide tõlgendamine on keerulisem. b<sub>1</sub> on otse tõlgendatav ainult siis, kui x<sub>2</sub>=0 (ja b<sub>2</sub> ainult siis, kui x<sub>1</sub>=0). Hiljem õpime selliseid mudeleid graafiliselt tõlgendama. Mudeli koefitsientide otse tõlgendamine ei ole siin sageli perspektiivikas.</p>
<blockquote>
<p>Interaktsioonimudelis sõltub x<sub>1</sub> mõju tugevus y-le x<sub>2</sub> väärtusest. Selle sõltuvuse määra kirjeldab b<sub>3</sub> (x<sub>1</sub> &amp; x<sub>2</sub> interaktsiooni tugevus). Samamoodi ja sümmeetriliselt erineb ka x<sub>2</sub> mõju erinevatel x<sub>1</sub> väärtustel. Ainult siis, kui x<sub>2</sub> = 0, ennustab x<sub>1</sub> tõus 1 ühiku võrra y muutust b<sub>1</sub> ühiku võrra.</p>
</blockquote>
<p>Interaktsioonimudeli 2D avaldus on kurvatuuriga tasapind, kusjuures kurvatuuri määrab b<sub>3</sub>.</p>
<p>Interaktsiooniga mudel on AIC-i järgi pisut vähem eelistatud võrreldes m1-ga. Seega, eriti lihtsuse huvides, eelistame m1-e.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m2 &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="dt">data=</span>iris, 
         Sepal.Width<span class="op">~</span>Sepal.Length <span class="op">+</span><span class="st"> </span>
<span class="st">           </span>Petal.Length <span class="op">+</span><span class="st"> </span>
<span class="st">           </span>Sepal.Length<span class="op">*</span>Petal.Length) 
<span class="kw">AIC</span>(m, m1, m2)</code></pre></div>
<pre><code>##    df    AIC
## m   3 179.46
## m1  4  92.12
## m2  5  93.43</code></pre>
<p><strong>ennustused interaktsioonimudelist</strong></p>
<p>Kõigepealt anname rea väärtusi x<sub>1</sub>-le ja hoiame x<sub>2</sub> konstantsena.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Sepal_length &lt;-<span class="st">  </span><span class="kw">seq</span>(<span class="kw">min</span>(iris<span class="op">$</span>Sepal.Length), 
                     <span class="kw">max</span>(iris<span class="op">$</span>Sepal.Length), 
                     <span class="dt">length.out =</span> <span class="dv">100</span>) 
Petal_length &lt;-<span class="st">  </span><span class="kw">mean</span>(iris<span class="op">$</span>Petal.Length)

a &lt;-<span class="st"> </span><span class="kw">coef</span>(m2)[<span class="dv">1</span>]
b1 &lt;-<span class="st"> </span><span class="kw">coef</span>(m2)[<span class="dv">2</span>]
b2 &lt;-<span class="st"> </span><span class="kw">coef</span>(m2)[<span class="dv">3</span>]
b3 &lt;-<span class="st"> </span><span class="kw">coef</span>(m2)[<span class="dv">4</span>]

Sepal_width &lt;-<span class="st">   </span>a <span class="op">+</span><span class="st"> </span>b1<span class="op">*</span>Sepal_length <span class="op">+</span><span class="st"> </span>
<span class="st">  </span>b2<span class="op">*</span>Petal_length <span class="op">+</span><span class="st"> </span>
<span class="st">  </span>b3<span class="op">*</span>Sepal_length<span class="op">*</span>Petal_length

<span class="kw">plot</span>(Sepal_width <span class="op">~</span><span class="st"> </span>Sepal_length, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">6</span>))
<span class="kw">abline</span>(m1, <span class="dt">lty=</span><span class="dv">2</span>)</code></pre></div>
<pre><code>## Warning in abline(m1, lty = 2): only using the first
## two of 3 regression coefficients</code></pre>
<p><img src="main_files/figure-html/unnamed-chunk-255-1.svg" width="672" /></p>
<p>Tulemuseks on sirge, mis on paraleelne ilma interaktsioonita mudeli ennustusele (katkendjoon)</p>
<p>Nagu näha, korrutamistehe viib selleni, et interaktsioonimudeli tõus erineb ilma interaktsioonita mudeli tõusust.</p>
<p>Kui aga interaktsioonimudel plottida välja 3D-s üle paljude x<sub>1</sub> ja x<sub>2</sub> väärtuste, saame me regressioonikurvi (mitte sirge), kus b<sub>3</sub> annab kurvatuuri.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Sepal_length &lt;-<span class="st">  </span><span class="kw">seq</span>(<span class="kw">min</span>(iris<span class="op">$</span>Sepal.Length), 
                     <span class="kw">max</span>(iris<span class="op">$</span>Sepal.Length), 
                     <span class="dt">length.out =</span> <span class="dv">100</span>) 
Petal_length &lt;-<span class="st">  </span><span class="kw">seq</span>(<span class="kw">min</span>(iris<span class="op">$</span>Petal.Length), 
                     <span class="kw">max</span>(iris<span class="op">$</span>Petal.Length), 
                     <span class="dt">length.out =</span> <span class="dv">100</span>) 
a &lt;-<span class="st"> </span><span class="kw">coef</span>(m2)[<span class="dv">1</span>]
b1 &lt;-<span class="st"> </span><span class="kw">coef</span>(m2)[<span class="dv">2</span>]
b2 &lt;-<span class="st"> </span><span class="kw">coef</span>(m2)[<span class="dv">3</span>]
b3 &lt;-<span class="st"> </span><span class="kw">coef</span>(m2)[<span class="dv">4</span>]

Sepal_width &lt;-<span class="st">   </span>a <span class="op">+</span><span class="st"> </span>b1<span class="op">*</span>Sepal_length <span class="op">+</span><span class="st"> </span>
<span class="st">  </span>b2<span class="op">*</span>Petal_length <span class="op">+</span><span class="st"> </span>
<span class="st">  </span>b3<span class="op">*</span>Sepal_length<span class="op">*</span>Petal_length

df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Sepal_width=</span>Sepal_width, 
                 <span class="dt">Sepal_length=</span>Sepal_length, 
                 <span class="dt">Petal_length=</span>Petal_length)
<span class="kw">scatterplot3d</span>(df<span class="op">$</span>Sepal_length, 
              df<span class="op">$</span>Petal_length, 
              df<span class="op">$</span>Sepal_width, 
              <span class="dt">col.axis=</span><span class="st">&quot;blue&quot;</span>, 
              <span class="dt">col.grid=</span><span class="st">&quot;lightblue&quot;</span>, 
              <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-256-1.svg" width="672" /></p>
<p>Vau! See on alles ennustus!</p>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="graafilised-lahendused.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bibliograafia.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstats-tartu/lectures/edit/master/07-tidyverse.Rmd",
"text": "Edit"
},
"download": ["main.pdf", "main.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
